<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î—Ä–µ–≤–Ω–∏–µ –ê–ª–≥–æ—Ä–∏—Ç–º—ã | –¢–æ—Ä–≥–æ–≤—ã–π –°–∏–º—É–ª—è—Ç–æ—Ä</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'Ancient';
            src: url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        }

        :root {
            --color-bg: #1a1200;
            --color-surface: #2a1e00;
            --color-card: #3a2c00;
            --color-primary: #d4af37;
            --color-success: #8b7355;
            --color-warning: #c19a6b;
            --color-danger: #8b0000;
            --color-info: #b8860b;
            --color-text: #f5deb3;
            --color-text-muted: #cd853f;
            --border-radius: 8px;
            --font-main: 'Cinzel', serif;
        }

        body {
            background: 
                radial-gradient(ellipse at center, #0f0a00 0%, #1a1200 70%),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="parchment" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%231a1200"/><path d="M0,50 Q25,40 50,50 T100,50" stroke="%233a2c00" stroke-width="1" fill="none" opacity="0.2"/><path d="M50,0 Q40,25 50,50 T50,100" stroke="%233a2c00" stroke-width="1" fill="none" opacity="0.2"/></pattern></defs></svg>');
            color: var(--color-text);
            min-height: 100vh;
            overflow: hidden;
            padding: 16px;
            font-family: var(--font-main);
        }

        .game-container {
            max-width: 1800px;
            height: calc(100vh - 32px);
            margin: 0 auto;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 16px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="stone" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%232a1e00"/><path d="M0,20 L100,20 M0,40 L100,40 M0,60 L100,60 M0,80 L100,80" stroke="%233a2c00" stroke-width="2"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 16px 24px;
            border: 2px solid var(--color-primary);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(212, 175, 55, 0.1);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 24px;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="crack" patternUnits="userSpaceOnUse" width="20" height="20"><path d="M0,20 L20,0 M5,20 L20,5 M10,20 L20,10" stroke="%238b7355" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100%" height="100%" fill="url(%23crack)"/></svg>');
            pointer-events: none;
        }

        .game-title {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .game-title h1 {
            font-size: 28px;
            background: linear-gradient(90deg, var(--color-primary), #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
        }

        .era-display {
            text-align: center;
            min-width: 180px;
            background: rgba(42, 30, 0, 0.7);
            padding: 10px 20px;
            border-radius: 6px;
            border: 1px solid var(--color-primary);
        }

        .era-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .era-year {
            font-size: 14px;
            color: var(--color-text-muted);
        }

        .year-display {
            text-align: center;
            min-width: 120px;
            background: rgba(42, 30, 0, 0.7);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--color-primary);
        }

        .year-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .year-label {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        .main-area {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 16px;
            height: 100%;
            overflow: hidden;
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
        }

        .stats-section {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="wood" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%232a1e00"/><path d="M0,0 L100,100 M0,100 L100,0" stroke="%233a2c00" stroke-width="1" opacity="0.2"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 20px;
            border: 2px solid var(--color-primary);
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--color-primary);
            padding-bottom: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: rgba(58, 44, 0, 0.6);
            border-radius: 6px;
            padding: 14px;
            text-align: center;
            border: 1px solid var(--color-text-muted);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-primary), transparent);
        }

        .stat-card:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--color-primary);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .stat-label {
            font-size: 11px;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –ö–∞—Ä—Ç–∞ */
        .map-section {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="ancientMap" patternUnits="userSpaceOnUse" width="200" height="200"><rect width="200" height="200" fill="%232a1e00"/><path d="M20,20 L180,20 M20,40 L180,40 M20,60 L180,60 M20,80 L180,80 M20,100 L180,100 M20,120 L180,120 M20,140 L180,140 M20,160 L180,160 M20,180 L180,180 M40,20 L40,180 M60,20 L60,180 M80,20 L80,180 M100,20 L100,180 M120,20 L120,180 M140,20 L140,180 M160,20 L160,180" stroke="%233a2c00" stroke-width="1" opacity="0.2"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 20px;
            border: 2px solid var(--color-primary);
            box-shadow: 
                inset 0 0 30px rgba(0, 0, 0, 0.7),
                0 4px 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .map-controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .map-control-btn {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: rgba(58, 44, 0, 0.9);
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .map-control-btn:hover {
            background: var(--color-primary);
            color: #1a1200;
            transform: scale(1.1);
        }

        .map-container-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            border-radius: 6px;
            cursor: grab;
            border: 1px solid var(--color-text-muted);
        }

        .map-container-wrapper:active {
            cursor: grabbing;
        }

        #gameMap {
            width: 2200px;
            height: 1800px;
            background: rgba(26, 18, 0, 0.7);
            position: relative;
            transform-origin: 0 0;
            transition: transform 0.1s ease;
        }

        /* –ì–æ—Ä–æ–¥–∞ */
        .city {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 10;
            border: 3px solid transparent;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .city.locked {
            opacity: 0.3;
            filter: grayscale(1);
            cursor: not-allowed;
            border: 3px dashed #555 !important;
        }

        .city.active {
            border-color: var(--color-primary);
            animation: cityPulse 3s infinite;
        }

        .city.has-trader {
            animation: cityPulse 1.5s infinite;
        }

        @keyframes cityPulse {
            0% { 
                box-shadow: 
                    0 0 0 0 rgba(212, 175, 55, 0.7),
                    0 4px 20px rgba(0, 0, 0, 0.5); 
            }
            70% { 
                box-shadow: 
                    0 0 0 20px rgba(212, 175, 55, 0),
                    0 4px 20px rgba(0, 0, 0, 0.5); 
            }
            100% { 
                box-shadow: 
                    0 0 0 0 rgba(212, 175, 55, 0),
                    0 4px 20px rgba(0, 0, 0, 0.5); 
            }
        }

        .city-icon {
            font-size: 40px;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
        }

        .city-name {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
            text-align: center;
            color: var(--color-primary);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        .city-info {
            font-size: 12px;
            text-align: center;
            line-height: 1.3;
        }

        .city-demand {
            color: var(--color-warning);
            font-weight: 600;
            background: rgba(58, 44, 0, 0.9);
            padding: 4px 8px;
            border-radius: 6px;
            margin: 4px 0;
            border: 2px solid var(--color-warning);
            display: inline-block;
            font-size: 11px;
        }

        .city-traders {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--color-success);
            color: #1a1200;
            font-size: 14px;
            font-weight: bold;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1a1200;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
            z-index: 15;
        }

        .city-range-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: calc(var(--merchant-range, 400) * 2px);
            height: calc(var(--merchant-range, 400) * 2px);
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .city-range-indicator.show {
            opacity: 1;
        }

        /* –¢–æ—Ä–≥–æ–≤—ã–µ –ø—É—Ç–∏ */
        .trade-route {
            position: absolute;
            height: 4px;
            background: linear-gradient(90deg, var(--color-primary), transparent);
            border-radius: 2px;
            transform-origin: 0 0;
            z-index: 5;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .trade-route.active {
            background: linear-gradient(90deg, var(--color-success), var(--color-primary));
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .trade-route.preview {
            background: rgba(212, 175, 55, 0.3);
            border: 1px dashed var(--color-primary);
            height: 3px;
        }

        .merchant {
            position: absolute;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-warning), #8b7355);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transform: translate(-50%, -50%);
            z-index: 20;
            transition: left 2s linear, top 2s linear;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.5),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
            border: 2px solid var(--color-primary);
            cursor: pointer;
        }

        .merchant.idle {
            animation: merchantFloat 3s infinite ease-in-out;
            background: linear-gradient(135deg, var(--color-primary), #b8860b);
        }

        @keyframes merchantFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0) scale(1); }
            50% { transform: translate(-50%, -50%) translateY(-8px) scale(1.05); }
        }

        .merchant.selected {
            border-color: var(--color-success);
            box-shadow: 0 0 25px rgba(139, 115, 85, 0.9);
            animation: merchantSelected 1.5s infinite;
        }

        @keyframes merchantSelected {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.15); }
        }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .footer {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="marble" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%232a1e00"/><path d="M0,0 Q25,15 50,0 T100,0" stroke="%233a2c00" stroke-width="2" fill="none" opacity="0.3"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 16px 24px;
            border: 2px solid var(--color-primary);
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 24px;
            align-items: center;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .action-btn {
            padding: 16px 32px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
            justify-content: center;
            font-family: var(--font-main);
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--color-primary), #b8860b);
            color: #1a1200;
        }

        .action-btn.primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.5);
        }

        .action-btn.warning {
            background: linear-gradient(135deg, var(--color-warning), #c19a6b);
            color: #1a1200;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, rgba(42, 30, 0, 0.95), rgba(26, 18, 0, 0.95));
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 20px;
            min-width: 350px;
            max-width: 450px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-message {
            font-size: 15px;
            color: var(--color-text);
            line-height: 1.6;
        }

        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .notification-close:hover {
            background: var(--color-primary);
            color: #1a1200;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 7, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.95), rgba(26, 18, 0, 0.95)),
                url('data:image/svg+xml;utf8,<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="modalPapyrus" patternUnits="userSpaceOnUse" width="200" height="200"><rect width="200" height="200" fill="%232a1e00"/><path d="M0,100 Q50,80 100,100 T200,100" stroke="%238b7355" stroke-width="1" fill="none" opacity="0.1"/></pattern></defs></svg>');
            border-radius: 12px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--color-primary);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 0 30px rgba(212, 175, 55, 0.1);
            position: relative;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: var(--color-primary);
            color: #1a1200;
            transform: rotate(90deg);
        }

        .modal-title {
            font-size: 28px;
            color: var(--color-primary);
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 15px;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: rgba(58, 44, 0, 0.6);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--color-text-muted);
        }

        .result-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .result-label {
            font-size: 12px;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .strategy-analysis {
            background: rgba(58, 44, 0, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--color-success);
        }

        .analysis-title {
            color: var(--color-success);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .strategy-tip {
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid var(--color-primary);
        }

        .strategy-tip h4 {
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π */
        .tooltip {
            position: absolute;
            background: rgba(26, 18, 0, 0.95);
            border: 2px solid var(--color-primary);
            border-radius: var(--border-radius);
            padding: 12px;
            max-width: 300px;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
            font-size: 13px;
            line-height: 1.4;
        }
        
        .tooltip.show {
            opacity: 1;
        }
        
        .tooltip-title {
            color: var(--color-primary);
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tutorial-highlight {
            animation: highlightPulse 2s infinite;
            position: relative;
            z-index: 1000;
        }
        
        @keyframes highlightPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
        }
        
        .city-info-details {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 18, 0, 0.95);
            border: 2px solid var(--color-primary);
            border-radius: var(--border-radius);
            padding: 15px;
            width: 250px;
            z-index: 100;
            margin-bottom: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
        }
        
        .city:hover .city-info-details {
            display: block;
        }
        
        .resource-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.2);
            margin-right: 8px;
        }
        
        .merchant-info {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 18, 0, 0.95);
            border: 2px solid var(--color-primary);
            border-radius: var(--border-radius);
            padding: 15px;
            min-width: 200px;
            z-index: 100;
            margin-bottom: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
            display: none;
        }
        
        .merchant:hover .merchant-info {
            display: block;
        }
        
        .speed-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(58, 44, 0, 0.6);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--color-text-muted);
        }
        
        .speed-btn {
            background: none;
            border: 1px solid var(--color-primary);
            color: var(--color-primary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .speed-btn:hover {
            background: var(--color-primary);
            color: #1a1200;
        }
        
        .speed-btn.active {
            background: var(--color-primary);
            color: #1a1200;
            font-weight: bold;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-playing {
            background: rgba(0, 128, 0, 0.2);
            border: 1px solid #32cd32;
            color: #32cd32;
        }
        
        .status-paused {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
            color: #ffa500;
        }
        
        .tutorial-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 7, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .tutorial-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .tutorial-step {
            background: linear-gradient(135deg, rgba(42, 30, 0, 0.95), rgba(26, 18, 0, 0.95));
            border-radius: 12px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--color-primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            position: relative;
        }
        
        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .profit-animation {
            position: fixed;
            z-index: 2000;
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
        }
        
        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px);
                opacity: 0;
            }
        }

        .upkeep-info {
            font-size: 11px;
            color: var(--color-text-muted);
            margin-top: 5px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .delivery-info {
            font-size: 10px;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="header">
            <div class="game-title">
                <i class="fas fa-scroll" style="color: var(--color-primary); font-size: 32px;"></i>
                <h1>–î—Ä–µ–≤–Ω–∏–µ –ê–ª–≥–æ—Ä–∏—Ç–º—ã</h1>
            </div>
            
            <div class="era-display">
                <div class="era-name" id="eraName">–î–†–ï–í–ù–û–°–¢–¨</div>
                <div class="era-year" id="eraYears">3000-1000 –≥–≥. –¥–æ –Ω.—ç.</div>
            </div>
            
            <div class="year-display">
                <div class="year-number" id="yearNumber">3000</div>
                <div class="year-label">–î–û –ù–ê–®–ï–ô –≠–†–´</div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="main-area">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="left-panel">
                <div class="stats-section">
                    <div class="section-title">
                        <i class="fas fa-chess-king"></i>
                        <span>–¶–ê–†–°–¢–í–û –í–†–ï–ú–Å–ù</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="statGold">1500</div>
                            <div class="stat-label">–ó–û–õ–û–¢–´–• –ú–û–ù–ï–¢</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statTraders">1/1</div>
                            <div class="stat-label">–¢–û–†–ì–û–í–¶–ï–í –°–í–û–ë–û–î–ù–û</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statActiveTraders">0</div>
                            <div class="stat-label">–í –ü–£–¢–ò</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statCities">5/24</div>
                            <div class="stat-label">–û–¢–ö–†–´–¢–´–• –ì–û–†–û–î–û–í</div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="section-title">
                        <i class="fas fa-road"></i>
                        <span>–ú–ê–†–®–†–£–¢ –ö–ê–†–ê–í–ê–ù–ê</span>
                    </div>
                    <div id="routeInfo" style="color: var(--color-text-muted); font-size: 14px; padding: 15px; text-align: center;">
                        <div id="traderSelectionInfo">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—Ü–∞ –¥–ª—è –ø—Ä–æ–∫–ª–∞–¥–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞</div>
                        <div id="rangeInfo" style="margin-top: 10px; font-size: 12px; color: var(--color-warning);">
                            <i class="fas fa-ruler-combined"></i> –î–∞–ª—å–Ω–æ—Å—Ç—å: <span id="currentRange">400</span> —à–∞–≥–æ–≤
                        </div>
                    </div>
                    <div id="selectedRoute" style="display: none;">
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(58, 44, 0, 0.6); border-radius: 6px;">
                            <div style="color: var(--color-primary); font-weight: bold; margin-bottom: 8px; font-size: 13px;" id="routeCities"></div>
                            <div style="color: var(--color-warning); font-size: 11px; display: flex; justify-content: space-between;">
                                <span>–î–ª–∏–Ω–∞: <span id="routeDistance">0</span> —à–∞–≥–æ–≤</span>
                                <span>–ü—Ä–∏–±—ã–ª—å: <span id="routeProfit">0</span>üí∞</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button id="confirmRouteBtn" class="action-btn primary" style="flex: 1; padding: 12px; font-size: 13px;">
                                <i class="fas fa-check"></i>
                                <span>–ü–û–î–¢–í–ï–†–î–ò–¢–¨</span>
                            </button>
                            <button id="cancelRouteBtn" class="action-btn warning" style="width: 60px; padding: 12px; font-size: 13px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="section-title">
                        <i class="fas fa-history"></i>
                        <span>–õ–ï–¢–û–ü–ò–°–¨</span>
                    </div>
                    <div id="eventLog" style="height: 200px; overflow-y: auto; padding: 10px; background: rgba(58, 44, 0, 0.4); border-radius: 6px;">
                        <div style="color: var(--color-text-muted); font-size: 12px; text-align: center; padding: 20px;">
                            –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="map-section">
                <div class="map-container-wrapper" id="mapWrapper">
                    <div id="gameMap">
                        <!-- –ì–æ—Ä–æ–¥–∞ –∏ –ø—É—Ç–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
                
                <div class="map-controls">
                    <button class="map-control-btn" id="zoomInBtn">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="map-control-btn" id="zoomOutBtn">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="map-control-btn" id="centerMapBtn">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="footer">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="display: flex; align-items: center; gap: 12px; background: rgba(58, 44, 0, 0.6); padding: 12px 20px; border-radius: 8px; border: 1px solid var(--color-text-muted);">
                    <div style="font-size: 32px; color: var(--color-primary);">üèõÔ∏è</div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--color-primary);" id="goldValue">1500</div>
                        <div style="font-size: 11px; color: var(--color-text-muted); text-transform: uppercase;">–ö–ê–ó–ù–ê –¶–ê–†–°–¢–í–ê</div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 12px; background: rgba(58, 44, 0, 0.6); padding: 12px 20px; border-radius: 8px; border: 1px solid var(--color-text-muted);">
                    <div style="font-size: 32px; color: var(--color-primary);">üê´</div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--color-primary);" id="freeTradersValue">1</div>
                        <div style="font-size: 11px; color: var(--color-text-muted); text-transform: uppercase;">–°–í–û–ë–û–î–ù–´–ï –¢–û–†–ì–û–í–¶–´</div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 12px; background: rgba(58, 44, 0, 0.6); padding: 12px 20px; border-radius: 8px; border: 1px solid var(--color-text-muted);">
                    <div style="font-size: 32px; color: var(--color-primary);">‚è≥</div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--color-primary);" id="routeLengthValue">400</div>
                        <div style="font-size: 11px; color: var(--color-text-muted); text-transform: uppercase;">–î–ê–õ–¨–ù–û–°–¢–¨ –®–ê–ì–ê</div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <div class="speed-controls" id="speedControls">
                    <div style="font-size: 12px; color: var(--color-text-muted);">–°–ö–û–†–û–°–¢–¨:</div>
                    <button class="speed-btn active" data-speed="1">1x</button>
                    <button class="speed-btn" data-speed="2">2x</button>
                    <button class="speed-btn" data-speed="3">3x</button>
                </div>
                <button class="action-btn primary" id="playPauseBtn">
                    <i class="fas fa-play"></i>
                    <span>–ù–ê–ß–ê–¢–¨ –≠–ü–û–•–£</span>
                </button>
                <button class="action-btn warning" id="autoRouteBtn" disabled>
                    <i class="fas fa-robot"></i>
                    <span>–ê–í–¢–û-–ú–ê–†–®–†–£–¢ (50üí∞)</span>
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h2 class="modal-title">‚ö†Ô∏è –û–°–¢–ê–õ–ò–°–¨ –°–í–û–ë–û–î–ù–´–ï –¢–û–†–ì–û–í–¶–´</h2>
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 80px; color: var(--color-warning); margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div style="font-size: 18px; color: var(--color-text); line-height: 1.6;">
                    –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å <span id="freeTradersCount" style="color: var(--color-primary); font-weight: bold;">1</span> —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤.<br>
                    –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è?
                </div>
            </div>
            
            <div style="display: flex; gap: 20px; justify-content: center;">
                <button class="action-btn primary" id="confirmContinueBtn" style="min-width: 180px;">
                    <i class="fas fa-play"></i>
                    <span>–ü–†–û–î–û–õ–ñ–ò–¢–¨</span>
                </button>
                <button class="action-btn warning" id="cancelContinueBtn" style="min-width: 180px;">
                    <i class="fas fa-edit"></i>
                    <span>–†–ê–°–ü–†–ï–î–ï–õ–ò–¢–¨</span>
                </button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <button class="notification-close">&times;</button>
        <div class="notification-title" id="notificationTitle"></div>
        <div class="notification-message" id="notificationMessage"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <h2 class="modal-title" id="resultsTitle">–ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê!</h2>
            <div style="text-align: center; margin-bottom: 30px; font-size: 18px; color: var(--color-text);" id="resultsMessage"></div>
            
            <div class="results-grid">
                <div class="result-stat">
                    <div class="result-value" id="finalGold">0</div>
                    <div class="result-label">–§–ò–ù–ê–õ–¨–ù–ê–Ø –ö–ê–ó–ù–ê</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="finalRoutes">0</div>
                    <div class="result-label">–°–û–ó–î–ê–ù–û –ü–£–¢–ï–ô</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="finalTraders">0</div>
                    <div class="result-label">–¢–û–†–ì–û–í–¶–ï–í –ú–ê–ö–°</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="finalScore">0</div>
                    <div class="result-label">–û–¶–ï–ù–ö–ê –¶–ê–†–Ø</div>
                </div>
            </div>

            <div class="strategy-analysis">
                <h3 class="analysis-title"><i class="fas fa-chart-bar"></i> –ê–ù–ê–õ–ò–ó –°–¢–†–ê–¢–ï–ì–ò–ò</h3>
                <div id="strategyAnalysis"></div>
            </div>

            <button class="action-btn primary" style="margin-top: 30px; width: 100%;" onclick="location.reload()">
                <i class="fas fa-redo"></i>
                <span>–ù–ê–ß–ê–¢–¨ –ù–û–í–£–Æ –ò–ì–†–£</span>
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—É—á–µ–Ω–∏—è -->
    <div class="tutorial-modal" id="tutorialModal">
        <div class="tutorial-step" id="tutorialStep1">
            <h2 class="modal-title">üéÆ –û–ë–£–ß–ï–ù–ò–ï</h2>
            <div style="text-align: center; margin: 30px 0;">
                <div style="font-size: 80px; color: var(--color-primary); margin-bottom: 20px;">
                    üèõÔ∏è
                </div>
                <div style="font-size: 18px; color: var(--color-text); line-height: 1.6; margin-bottom: 20px;">
                    <strong>–î—Ä–µ–≤–Ω–∏–µ –ê–ª–≥–æ—Ä–∏—Ç–º—ã</strong> - —Ç–æ—Ä–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –≥–¥–µ –≤—ã —Ä–∞–∑–≤–∏–≤–∞–µ—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Å–µ—Ç—å —á–µ—Ä–µ–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —ç–ø–æ—Ö–∏.
                </div>
                <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4 style="color: var(--color-primary); margin-bottom: 10px;"><i class="fas fa-bullseye"></i> –¶–ï–õ–¨ –ò–ì–†–´</h4>
                    <p style="font-size: 14px;">–°–æ–∑–¥–∞–π—Ç–µ —Å–∞–º—É—é –±–æ–≥–∞—Ç—É—é —Ç–æ—Ä–≥–æ–≤—É—é –∏–º–ø–µ—Ä–∏—é –∫ 2020 –≥–æ–¥—É –Ω.—ç., –æ—Ç–∫—Ä—ã–≤–∞—è –Ω–æ–≤—ã–µ –≥–æ—Ä–æ–¥–∞ –∏ —Å–æ–∑–¥–∞–≤–∞—è –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã.</p>
                </div>
            </div>
            
            <div class="tutorial-navigation">
                <button class="action-btn warning" id="skipTutorialBtn">
                    <i class="fas fa-forward"></i>
                    <span>–ü–†–û–ü–£–°–¢–ò–¢–¨</span>
                </button>
                <button class="action-btn primary" id="nextTutorialBtn">
                    <i class="fas fa-arrow-right"></i>
                    <span>–î–ê–õ–ï–ï</span>
                </button>
            </div>
        </div>
        
        <div class="tutorial-step" id="tutorialStep2" style="display: none;">
            <h2 class="modal-title">üèôÔ∏è –ì–û–†–û–î–ê</h2>
            <div style="margin: 30px 0;">
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üåæ</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–ö–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Ä–µ—Å—É—Ä—Å</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–ì–æ—Ä–æ–¥ –£—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ü—à–µ–Ω–∏—Ü—É (üåæ) —Å—Ç–æ–∏–º–æ—Å—Ç—å—é 20üí∞</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üç∑</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–ò –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º —Ä–µ—Å—É—Ä—Å–µ</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–£—Ä—É –Ω—É–∂–Ω–æ –í–∏–Ω–æ (üç∑) - –¥–æ—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏!</p>
                    </div>
                </div>
                
                <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4 style="color: var(--color-primary); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> –°–û–í–ï–¢</h4>
                    <p style="font-size: 14px;">–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –≥–æ—Ä–æ–¥, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—Å—É—Ä—Å–∞—Ö.</p>
                </div>
            </div>
            
            <div class="tutorial-navigation">
                <button class="action-btn warning" id="prevTutorialBtn1">
                    <i class="fas fa-arrow-left"></i>
                    <span>–ù–ê–ó–ê–î</span>
                </button>
                <button class="action-btn primary" id="nextTutorialBtn2">
                    <i class="fas fa-arrow-right"></i>
                    <span>–î–ê–õ–ï–ï</span>
                </button>
            </div>
        </div>
        
        <div class="tutorial-step" id="tutorialStep3" style="display: none;">
            <h2 class="modal-title">üê´ –¢–û–†–ì–û–í–¶–´</h2>
            <div style="margin: 30px 0;">
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üê´</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã</h4>
                        <p style="font-size: 14px; color: var(--color-text);">1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤—Ü–∞<br>2. –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è<br>3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üîÑ</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–ï—Å–ª–∏ —Ç–æ—Ä–≥–æ–≤–µ—Ü –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥, –¥–∞–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è!</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üéÅ</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–û—Ç–∫—Ä—ã—Ç–∏–µ –≥–æ—Ä–æ–¥–æ–≤</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–ö–æ–≥–¥–∞ —Ç–æ—Ä–≥–æ–≤–µ—Ü –≤–ø–µ—Ä–≤—ã–µ –ø–æ—Å–µ—â–∞–µ—Ç –≥–æ—Ä–æ–¥, —Ç–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞!</p>
                    </div>
                </div>
            </div>
            
            <div class="tutorial-navigation">
                <button class="action-btn warning" id="prevTutorialBtn2">
                    <i class="fas fa-arrow-left"></i>
                    <span>–ù–ê–ó–ê–î</span>
                </button>
                <button class="action-btn primary" id="nextTutorialBtn3">
                    <i class="fas fa-arrow-right"></i>
                    <span>–î–ê–õ–ï–ï</span>
                </button>
            </div>
        </div>
        
        <div class="tutorial-step" id="tutorialStep4" style="display: none;">
            <h2 class="modal-title">‚è≥ –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–†–ï–ú–ï–ù–ï–ú</h2>
            <div style="margin: 30px 0;">
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">‚è∏Ô∏è</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–ò–≥—Ä–∞ –ø–æ—à–∞–≥–æ–≤–∞—è</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–°–æ–∑–¥–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ù–ê–ß–ê–¢–¨ –≠–ü–û–•–£". –¢–æ—Ä–≥–æ–≤—Ü—ã –Ω–∞—á–Ω—É—Ç –¥–≤–∏–∂–µ–Ω–∏–µ.</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üí∏</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–ö–∞–∂–¥—ã–π –≥–æ–¥ –ø–ª–∞—Ç–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: 2üí∞ –∑–∞ —Ç–æ—Ä–≥–æ–≤—Ü–∞ + 1üí∞ –∑–∞ –æ—Ç–∫—Ä—ã—Ç—ã–π –≥–æ—Ä–æ–¥.</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <div style="font-size: 50px;">üèÜ</div>
                    <div>
                        <h4 style="color: var(--color-primary); margin-bottom: 5px;">–ü–æ–±–µ–¥–∞ –∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ</h4>
                        <p style="font-size: 14px; color: var(--color-text);">–ò–≥—Ä–∞ –¥–æ 2020 –≥–æ–¥–∞ –Ω.—ç. –∏–ª–∏ –¥–æ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞. –ß–µ–º –±–æ–ª—å—à–µ –∑–æ–ª–æ—Ç–∞ - —Ç–µ–º –≤—ã—à–µ —Å—á—ë—Ç!</p>
                    </div>
                </div>
                
                <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4 style="color: var(--color-primary); margin-bottom: 10px;"><i class="fas fa-robot"></i> –ê–í–¢–û-–ú–ê–†–®–†–£–¢</h4>
                    <p style="font-size: 14px;">–ó–∞ 50üí∞ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞.</p>
                </div>
            </div>
            
            <div class="tutorial-navigation">
                <button class="action-btn warning" id="prevTutorialBtn3">
                    <i class="fas fa-arrow-left"></i>
                    <span>–ù–ê–ó–ê–î</span>
                </button>
                <button class="action-btn primary" id="startGameBtn">
                    <i class="fas fa-play"></i>
                    <span>–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</span>
                </button>
            </div>
        </div>
    </div>

    <!-- –¢—É–ª—Ç–∏–ø -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        class HistoricalTradingGame {
            constructor() {
                // –ò–≥—Ä–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                this.gold = 1500;
                this.totalTraders = 1;
                this.availableTraders = 1;
                this.activeTraders = 0;
                this.year = -3000;
                this.maxYears = 5020;
                this.gameOver = false;
                this.isPlaying = false;
                this.currentEra = 0;
                this.merchantRange = 800;
                this.gameSpeed = 1;
                this.isTutorialCompleted = localStorage.getItem('tutorialCompleted') === 'true';
                
                // –≠–ø–æ—Ö–∏
                this.eras = [
                    { name: "–î–†–ï–í–ù–û–°–¢–¨", start: -3000, end: -1000, color: "#8b7355", icon: "üè∫" },
                    { name: "–ê–ù–¢–ò–ß–ù–û–°–¢–¨", start: -999, end: 476, color: "#d4af37", icon: "‚öîÔ∏è" },
                    { name: "–°–†–ï–î–ù–ï–í–ï–ö–û–í–¨–ï", start: 477, end: 1492, color: "#8b0000", icon: "üè∞" },
                    { name: "–ù–û–í–û–ï –í–†–ï–ú–Ø", start: 1493, end: 1914, color: "#b8860b", icon: "‚öì" },
                    { name: "–°–û–í–†–ï–ú–ï–ù–ù–û–°–¢–¨", start: 1915, end: 2020, color: "#cd853f", icon: "üöÄ" }
                ];
                
                // –ì–æ—Ä–æ–¥–∞ –∏ —Ç–æ—Ä–≥–æ–≤—Ü—ã
                this.cities = [];
                this.traders = [];
                this.routes = [];
                this.discoveredCities = new Set();
                this.cityConnections = new Map();
                
                // –í—ã–±–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∞
                this.selectedTrader = null;
                this.routeInProgress = [];
                this.previewRoutes = [];
                this.showingRange = false;
                
                // –°—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
                this.upkeepPerTrader = 2;
                this.upkeepPerCity = 1;
                
                // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
                this.events = [];
                this.lastEventYear = -3000;
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π
                this.mapScale = 0.7;
                this.mapX = 0;
                this.mapY = 0;
                this.isDragging = false;
                this.dragStartX = 0;
                this.dragStartY = 0;
                this.mapStartX = 0;
                this.mapStartY = 0;
                
                // –¢–µ–∫—É—â–∏–π —à–∞–≥ –æ–±—É—á–µ–Ω–∏—è
                this.tutorialStep = 1;
                
                // –¢–∞–π–º–µ—Ä—ã –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
                this.gameLoop = null;
                this.yearProcessingTime = 3000;
                
                // –†–µ—Å—É—Ä—Å—ã –ø–æ —ç–ø–æ—Ö–∞–º
                this.resourcesByEra = [
                    // –î—Ä–µ–≤–Ω–æ—Å—Ç—å
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 20, demand: 'wine' },
                        { id: 'wine', name: '–í–∏–Ω–æ', icon: 'üç∑', value: 30, demand: 'oil' },
                        { id: 'oil', name: '–ú–∞—Å–ª–æ', icon: 'ü´í', value: 25, demand: 'grain' },
                        { id: 'copper', name: '–ú–µ–¥—å', icon: 'üîß', value: 35, demand: 'wine' },
                        { id: 'salt', name: '–°–æ–ª—å', icon: 'üßÇ', value: 22, demand: 'grain' }
                    ],
                    // –ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 25, demand: 'wine' },
                        { id: 'wine', name: '–í–∏–Ω–æ', icon: 'üç∑', value: 35, demand: 'marble' },
                        { id: 'marble', name: '–ú—Ä–∞–º–æ—Ä', icon: 'üóø', value: 45, demand: 'oil' },
                        { id: 'metal', name: '–ë—Ä–æ–Ω–∑–∞', icon: 'üõ°Ô∏è', value: 40, demand: 'grain' },
                        { id: 'glass', name: '–°—Ç–µ–∫–ª–æ', icon: 'ü•É', value: 37, demand: 'wine' }
                    ],
                    // –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 30, demand: 'wine' },
                        { id: 'wine', name: '–í–∏–Ω–æ', icon: 'üç∑', value: 40, demand: 'spice' },
                        { id: 'spice', name: '–ü—Ä—è–Ω–æ—Å—Ç–∏', icon: 'üå∂Ô∏è', value: 50, demand: 'silk' },
                        { id: 'silk', name: '–®—ë–ª–∫', icon: 'üëò', value: 55, demand: 'metal' },
                        { id: 'metal', name: '–ñ–µ–ª–µ–∑–æ', icon: '‚öîÔ∏è', value: 45, demand: 'grain' },
                        { id: 'fur', name: '–ú–µ—Ö–∞', icon: 'üß•', value: 42, demand: 'salt' }
                    ],
                    // –ù–æ–≤–æ–µ –≤—Ä–µ–º—è
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 35, demand: 'silk' },
                        { id: 'silk', name: '–®—ë–ª–∫', icon: 'üëò', value: 65, demand: 'spice' },
                        { id: 'spice', name: '–ü—Ä—è–Ω–æ—Å—Ç–∏', icon: 'üå∂Ô∏è', value: 75, demand: 'tea' },
                        { id: 'tea', name: '–ß–∞–π', icon: 'üçµ', value: 60, demand: 'coffee' },
                        { id: 'coffee', name: '–ö–æ—Ñ–µ', icon: '‚òï', value: 70, demand: 'sugar' },
                        { id: 'sugar', name: '–°–∞—Ö–∞—Ä', icon: 'üç¨', value: 55, demand: 'grain' },
                        { id: 'cotton', name: '–•–ª–æ–ø–æ–∫', icon: 'üëï', value: 50, demand: 'tea' }
                    ],
                    // –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å
                    [
                        { id: 'oil', name: '–ù–µ—Ñ—Ç—å', icon: 'üõ¢Ô∏è', value: 100, demand: 'tech' },
                        { id: 'tech', name: '–¢–µ—Ö–Ω–∏–∫–∞', icon: 'üíª', value: 150, demand: 'oil' },
                        { id: 'cars', name: '–ê–≤—Ç–æ', icon: 'üöó', value: 120, demand: 'oil' },
                        { id: 'medicine', name: '–õ–µ–∫–∞—Ä—Å—Ç–≤–∞', icon: 'üíä', value: 130, demand: 'tech' },
                        { id: 'food', name: '–ü—Ä–æ–¥—É–∫—Ç—ã', icon: 'üçî', value: 85, demand: 'tech' },
                        { id: 'electronics', name: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', icon: 'üì±', value: 145, demand: 'oil' }
                    ]
                ];
                
                // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –≥–æ—Ä–æ–¥–∞
                this.historicalCities = [
                    // –≠–ø–æ—Ö–∞ –î—Ä–µ–≤–Ω–æ—Å—Ç–∏ - 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
                    { name: "–£—Ä", era: 0, x: 300, y: 300, isActive: true, connections: [5, 6, 7, 8] },
                    { name: "–ú–µ–º—Ñ–∏—Å", era: 0, x: 1000, y: 400, isActive: true, connections: [5, 9, 10] },
                    { name: "–í–∞–≤–∏–ª–æ–Ω", era: 0, x: 600, y: 800, isActive: true, connections: [6, 7, 11] },
                    { name: "–ù–∏–Ω–µ–≤–∏—è", era: 0, x: 1500, y: 600, isActive: true, connections: [8, 11, 12] },
                    { name: "–°—É–∑—ã", era: 0, x: 1200, y: 1000, isActive: true, connections: [9, 10, 13] },
                    
                    // –≠–ø–æ—Ö–∞ –ê–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ - –±—É–¥—É—Ç –æ—Ç–∫—Ä—ã—Ç—ã
                    { name: "–ê—Ñ–∏–Ω—ã", era: 1, x: 200, y: 1500, isActive: false, connections: [14, 15, 16] },
                    { name: "–†–∏–º", era: 1, x: 800, y: 1600, isActive: false, connections: [14, 17, 18] },
                    { name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è", era: 1, x: 1600, y: 1400, isActive: false, connections: [15, 19, 20] },
                    { name: "–ö–∞—Ä—Ñ–∞–≥–µ–Ω", era: 1, x: 1800, y: 300, isActive: false, connections: [16, 21, 22] },
                    
                    // –≠–ø–æ—Ö–∞ –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å—è
                    { name: "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å", era: 2, x: 900, y: 200, isActive: false, connections: [17, 19, 23] },
                    { name: "–í–µ–Ω–µ—Ü–∏—è", era: 2, x: 400, y: 1200, isActive: false, connections: [18, 20, 21] },
                    { name: "–ë–∞–≥–¥–∞–¥", era: 2, x: 1700, y: 900, isActive: false, connections: [22, 23] },
                    
                    // –≠–ø–æ—Ö–∞ –ù–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    { name: "–ü–∞—Ä–∏–∂", era: 3, x: 300, y: 700, isActive: false, connections: [] },
                    { name: "–õ–æ–Ω–¥–æ–Ω", era: 3, x: 100, y: 500, isActive: false, connections: [] },
                    { name: "–ê–º—Å—Ç–µ—Ä–¥–∞–º", era: 3, x: 500, y: 200, isActive: false, connections: [] },
                    
                    // –≠–ø–æ—Ö–∞ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
                    { name: "–ù—å—é-–ô–æ—Ä–∫", era: 4, x: 1800, y: 1600, isActive: false, connections: [] },
                    { name: "–¢–æ–∫–∏–æ", era: 4, x: 2000, y: 800, isActive: false, connections: [] },
                    { name: "–®–∞–Ω—Ö–∞–π", era: 4, x: 1900, y: 1200, isActive: false, connections: [] },
                    { name: "–ë–µ—Ä–ª–∏–Ω", era: 4, x: 700, y: 400, isActive: false, connections: [] },
                    { name: "–ú—É–º–±–∞–∏", era: 4, x: 1400, y: 1700, isActive: false, connections: [] },
                    { name: "–°—Ç–∞–º–±—É–ª", era: 4, x: 1000, y: 1200, isActive: false, connections: [] },
                    { name: "–ö–∞–∏—Ä", era: 4, x: 1100, y: 500, isActive: false, connections: [] },
                    { name: "–î–∞–º–∞—Å–∫", era: 4, x: 1300, y: 300, isActive: false, connections: [] },
                    { name: "–ú–∞–¥—Ä–∏–¥", era: 4, x: 200, y: 1000, isActive: false, connections: [] }
                ];
                
                this.init();
            }

            init() {
                this.setupMapControls();
                this.createCities();
                this.createInitialTrader();
                this.setupEventListeners();
                this.updateUI();
                this.updateEra();
                this.centerMap();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                if (!this.isTutorialCompleted) {
                    setTimeout(() => {
                        this.showTutorial();
                    }, 1000);
                } else {
                    this.showNotification("üèõÔ∏è –î–†–ï–í–ù–û–°–¢–¨ –ù–ê–ß–ê–õ–ê–°–¨", "3000 –ª–µ—Ç –¥–æ –Ω.—ç. 5 –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏.");
                    this.logEvent("3000 –≥. –¥–æ –Ω.—ç. - –ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ –î—Ä–µ–≤–Ω–æ—Å—Ç–∏");
                    this.logEvent("–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞: –£—Ä, –ú–µ–º—Ñ–∏—Å, –í–∞–≤–∏–ª–æ–Ω, –ù–∏–Ω–µ–≤–∏—è, –°—É–∑—ã");
                }
            }

            setupMapControls() {
                const mapWrapper = document.getElementById('mapWrapper');
                
                mapWrapper.addEventListener('mousedown', (e) => {
                    if (this.gameOver) return;
                    this.isDragging = true;
                    this.dragStartX = e.clientX;
                    this.dragStartY = e.clientY;
                    this.mapStartX = this.mapX;
                    this.mapStartY = this.mapY;
                    mapWrapper.style.cursor = 'grabbing';
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!this.isDragging || this.gameOver) return;
                    
                    const dx = e.clientX - this.dragStartX;
                    const dy = e.clientY - this.dragStartY;
                    
                    this.mapX = this.mapStartX + dx / this.mapScale;
                    this.mapY = this.mapStartY + dy / this.mapScale;
                    
                    this.updateMapTransform();
                });
                
                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                    mapWrapper.style.cursor = 'grab';
                });
                
                mapWrapper.addEventListener('wheel', (e) => {
                    if (this.gameOver) return;
                    e.preventDefault();
                    const zoomSpeed = 0.1;
                    const oldScale = this.mapScale;
                    
                    if (e.deltaY < 0) {
                        this.mapScale = Math.min(2, this.mapScale * (1 + zoomSpeed));
                    } else {
                        this.mapScale = Math.max(0.3, this.mapScale * (1 - zoomSpeed));
                    }
                    
                    const rect = mapWrapper.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;
                    const mouseY = e.clientY - rect.top;
                    
                    const scaleRatio = this.mapScale / oldScale;
                    this.mapX = mouseX - (mouseX - this.mapX) * scaleRatio;
                    this.mapY = mouseY - (mouseY - this.mapY) * scaleRatio;
                    
                    this.updateMapTransform();
                });
                
                document.getElementById('zoomInBtn').addEventListener('click', () => {
                    if (this.gameOver) return;
                    this.mapScale = Math.min(2, this.mapScale * 1.2);
                    this.updateMapTransform();
                });
                
                document.getElementById('zoomOutBtn').addEventListener('click', () => {
                    if (this.gameOver) return;
                    this.mapScale = Math.max(0.3, this.mapScale * 0.8);
                    this.updateMapTransform();
                });
                
                document.getElementById('centerMapBtn').addEventListener('click', () => {
                    if (this.gameOver) return;
                    this.centerMap();
                });
            }

            updateMapTransform() {
                const gameMap = document.getElementById('gameMap');
                gameMap.style.transform = `translate(${this.mapX}px, ${this.mapY}px) scale(${this.mapScale})`;
            }

            centerMap() {
                const wrapper = document.getElementById('mapWrapper');
                const map = document.getElementById('gameMap');
                
                this.mapScale = 0.7;
                this.mapX = (wrapper.clientWidth - map.clientWidth * this.mapScale) / 2;
                this.mapY = (wrapper.clientHeight - map.clientHeight * this.mapScale) / 2;
                
                this.updateMapTransform();
            }

            createCities() {
                const map = document.getElementById('gameMap');
                map.innerHTML = '';
                
                this.cities = [];
                this.historicalCities.forEach((cityData, index) => {
                    const eraResources = this.resourcesByEra[cityData.era];
                    const resource = eraResources[Math.floor(Math.random() * eraResources.length)];
                    
                    let demandResource;
                    do {
                        demandResource = eraResources[Math.floor(Math.random() * eraResources.length)];
                    } while (demandResource.id === resource.id);
                    
                    const city = {
                        id: index,
                        ...cityData,
                        resource: resource,
                        demand: demandResource,
                        isDiscovered: cityData.isActive,
                        visitedBy: new Set(),
                        tradersInCity: new Set(),
                        baseValue: resource.value,
                        currentValue: this.calculateCityValue(cityData, resource),
                        gaveTrader: false,
                        element: null,
                        rangeIndicator: null
                    };
                    
                    this.cities.push(city);
                    
                    if (city.isDiscovered) {
                        this.discoveredCities.add(city.id);
                    }
                    
                    if (cityData.connections) {
                        this.cityConnections.set(city.id, cityData.connections);
                    }
                    
                    const cityEl = this.createCityElement(city);
                    city.element = cityEl;
                    map.appendChild(cityEl);
                    
                    const rangeIndicator = document.createElement('div');
                    rangeIndicator.className = 'city-range-indicator';
                    rangeIndicator.style.setProperty('--merchant-range', this.merchantRange);
                    city.rangeIndicator = rangeIndicator;
                    cityEl.appendChild(rangeIndicator);
                });
            }

            calculateCityValue(cityData, resource) {
                let value = resource.value;
                const randomFactor = 0.8 + Math.random() * 0.4;
                value *= randomFactor;
                
                const majorCities = ['–£—Ä', '–í–∞–≤–∏–ª–æ–Ω', '–ú–µ–º—Ñ–∏—Å', '–ê—Ñ–∏–Ω—ã', '–†–∏–º', '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å'];
                if (majorCities.includes(cityData.name)) {
                    value *= 1.3;
                }
                
                return Math.round(value);
            }

            createCityElement(city) {
                const el = document.createElement('div');
                el.className = `city ${city.isDiscovered ? 'active' : 'locked'}`;
                el.style.left = `${city.x}px`;
                el.style.top = `${city.y}px`;
                el.style.background = this.getCityGradient(city.resource.id);
                el.dataset.cityId = city.id;
                
                const cityContent = document.createElement('div');
                cityContent.style.position = 'relative';
                
                if (!city.isDiscovered) {
                    cityContent.innerHTML = `
                        <div class="city-icon">‚ùì</div>
                        <div class="city-name">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</div>
                    `;
                } else {
                    cityContent.innerHTML = `
                        <div class="city-icon">${city.resource.icon}</div>
                        <div class="city-name">${city.name}</div>
                        <div class="city-info">
                            <div class="city-demand">–ù—É–∂–Ω–æ: ${city.demand.icon}</div>
                            <div class="city-value">${city.currentValue}üí∞</div>
                        </div>
                    `;
                    
                    const details = document.createElement('div');
                    details.className = 'city-info-details';
                    details.innerHTML = `
                        <div class="tooltip-title">${city.name}</div>
                        <div style="margin-bottom: 8px;">
                            <strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç:</strong><br>
                            <span class="resource-icon">${city.resource.icon}</span>
                            ${city.resource.name} (${city.currentValue}üí∞)
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>–ù—É–∂–¥–∞–µ—Ç—Å—è:</strong><br>
                            <span class="resource-icon">${city.demand.icon}</span>
                            ${city.demand.name}
                        </div>
                        <div style="font-size: 11px; color: var(--color-text-muted);">
                            –î–æ—Å—Ç–∞–≤–∫–∞ –Ω—É–∂–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –ø—Ä–∏–Ω–æ—Å–∏—Ç ${Math.round(city.currentValue * 1.5)}üí∞
                        </div>
                        ${city.gaveTrader ? '<div style="margin-top: 8px; color: var(--color-success);">‚úì –£–∂–µ –¥–∞–ª —Ç–æ—Ä–≥–æ–≤—Ü–∞</div>' : ''}
                    `;
                    cityContent.appendChild(details);
                }
                
                el.appendChild(cityContent);
                
                if (city.isDiscovered) {
                    el.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.selectCityForRoute(city);
                    });
                }
                
                el.addEventListener('mouseenter', (e) => {
                    if (this.gameOver) return;
                    this.showTooltip(e, city);
                });
                
                el.addEventListener('mousemove', (e) => {
                    if (this.gameOver) return;
                    this.moveTooltip(e);
                });
                
                el.addEventListener('mouseleave', () => {
                    this.hideTooltip();
                });
                
                return el;
            }

            getCityGradient(resourceId) {
                const gradients = {
                    'grain': 'linear-gradient(135deg, #d4af37, #b8860b)',
                    'wine': 'linear-gradient(135deg, #8b0000, #660000)',
                    'oil': 'linear-gradient(135deg, #808000, #556b2f)',
                    'copper': 'linear-gradient(135deg, #cd7f32, #b87333)',
                    'salt': 'linear-gradient(135deg, #f5f5f5, #dcdcdc)',
                    'marble': 'linear-gradient(135deg, #f5f5f5, #d3d3d3)',
                    'metal': 'linear-gradient(135deg, #a9a9a9, #696969)',
                    'glass': 'linear-gradient(135deg, #87ceeb, #4682b4)',
                    'silk': 'linear-gradient(135deg, #da70d6, #ba55d3)',
                    'spice': 'linear-gradient(135deg, #ff4500, #dc143c)',
                    'fur': 'linear-gradient(135deg, #8b4513, #654321)',
                    'tea': 'linear-gradient(135deg, #8b7355, #6b5c43)',
                    'coffee': 'linear-gradient(135deg, #8b4513, #654321)',
                    'sugar': 'linear-gradient(135deg, #ffe4e1, #ffb6c1)',
                    'cotton': 'linear-gradient(135deg, #f0f8ff, #e6e6fa)',
                    'tech': 'linear-gradient(135deg, #00bfff, #1e90ff)',
                    'cars': 'linear-gradient(135deg, #ff4500, #ff6347)',
                    'medicine': 'linear-gradient(135deg, #32cd32, #228b22)',
                    'food': 'linear-gradient(135deg, #ffd700, #daa520)',
                    'electronics': 'linear-gradient(135deg, #9370db, #8a2be2)'
                };
                return gradients[resourceId] || 'linear-gradient(135deg, #8b7355, #6b5c43)';
            }

            updateCityTradersDisplay(city) {
                if (!city.element) return;
                
                const oldCounter = city.element.querySelector('.city-traders');
                if (oldCounter) {
                    oldCounter.remove();
                }
                
                if (city.tradersInCity.size > 0) {
                    const counter = document.createElement('div');
                    counter.className = 'city-traders';
                    counter.textContent = city.tradersInCity.size;
                    city.element.querySelector('div').appendChild(counter);
                }
            }

            createInitialTrader() {
                const initialCity = this.cities.find(c => c.name === "–£—Ä");
                if (!initialCity) return;
                
                const trader = {
                    id: 0,
                    name: "–°–∏–Ω-–ê—Ö—Ö–µ-–†–∏–±–∞",
                    cityId: initialCity.id,
                    route: [],
                    currentPosition: 0,
                    isMoving: false,
                    isTraveling: false,
                    cargo: null,
                    goldEarned: 0,
                    element: null,
                    isIdle: true,
                    currentTargetCityId: null
                };
                
                this.traders.push(trader);
                initialCity.tradersInCity.add(trader.id);
                this.updateCityTradersDisplay(initialCity);
                this.createTraderElement(trader);
            }

            createTraderElement(trader) {
                const city = this.cities.find(c => c.id === trader.cityId);
                if (!city) return;
                
                const map = document.getElementById('gameMap');
                const merchant = document.createElement('div');
                merchant.className = `merchant ${trader.isIdle ? 'idle' : ''}`;
                merchant.style.left = `${city.x}px`;
                merchant.style.top = `${city.y}px`;
                merchant.dataset.traderId = trader.id;
                merchant.innerHTML = 'üê´';
                
                const info = document.createElement('div');
                info.className = 'merchant-info';
                info.innerHTML = `
                    <div class="tooltip-title">${trader.name}</div>
                    <div style="margin-bottom: 5px;">
                        <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> ${trader.isIdle ? '–°–≤–æ–±–æ–¥–µ–Ω' : '–í –ø—É—Ç–∏'}
                    </div>
                    <div style="margin-bottom: 5px;">
                        <strong>–ì–æ—Ä–æ–¥:</strong> ${city.name}
                    </div>
                    ${trader.cargo ? `<div style="margin-bottom: 5px;">
                        <strong>–ì—Ä—É–∑:</strong> ${trader.cargo.icon} ${trader.cargo.name}
                    </div>` : ''}
                    <div>
                        <strong>–ó–∞—Ä–∞–±–æ—Ç–∞–ª:</strong> ${trader.goldEarned}üí∞
                    </div>
                `;
                merchant.appendChild(info);
                
                merchant.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectTrader(trader);
                });
                
                merchant.addEventListener('mouseenter', (e) => {
                    if (this.gameOver) return;
                    this.showTooltip(e, trader, 'trader');
                });
                
                merchant.addEventListener('mousemove', (e) => {
                    if (this.gameOver) return;
                    this.moveTooltip(e);
                });
                
                merchant.addEventListener('mouseleave', () => {
                    this.hideTooltip();
                });
                
                trader.element = merchant;
                map.appendChild(merchant);
            }

            showTooltip(e, data, type = 'city') {
                const tooltip = document.getElementById('tooltip');
                let html = '';
                
                if (type === 'city') {
                    const city = data;
                    html = `
                        <div class="tooltip-title">
                            <span class="resource-icon">${city.resource.icon}</span>
                            ${city.name}
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç:</strong> ${city.resource.name} (${city.currentValue}üí∞)
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>–ù—É–∂–¥–∞–µ—Ç—Å—è:</strong> ${city.demand.icon} ${city.demand.name}
                        </div>
                        ${!city.isDiscovered ? 
                            '<div style="color: var(--color-warning);">–¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–∏–µ –≥–æ—Ä–æ–¥–∞</div>' :
                            `<div style="font-size: 11px; color: var(--color-text-muted);">
                                –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–∞—Ä—à—Ä—É—Ç
                            </div>`
                        }
                    `;
                } else {
                    const trader = data;
                    const city = this.cities.find(c => c.id === trader.cityId);
                    html = `
                        <div class="tooltip-title">üê´ ${trader.name}</div>
                        <div style="margin-bottom: 5px;">
                            <strong>–ì–æ—Ä–æ–¥:</strong> ${city?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                        </div>
                        <div style="margin-bottom: 5px;">
                            <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> ${trader.isIdle ? '–°–≤–æ–±–æ–¥–µ–Ω' : '–í –ø—É—Ç–∏'}
                        </div>
                        ${trader.cargo ? `<div style="margin-bottom: 5px;">
                            <strong>–ì—Ä—É–∑:</strong> ${trader.cargo.icon} ${trader.cargo.name}
                        </div>` : ''}
                        <div style="margin-bottom: 5px;">
                            <strong>–ó–∞—Ä–∞–±–æ—Ç–∞–ª:</strong> ${trader.goldEarned}üí∞
                        </div>
                        ${trader.isIdle ? 
                            '<div style="font-size: 11px; color: var(--color-success);">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞</div>' :
                            '<div style="font-size: 11px; color: var(--color-warning);">–í –ø—É—Ç–∏ - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å</div>'
                        }
                    `;
                }
                
                tooltip.innerHTML = html;
                tooltip.classList.add('show');
                this.moveTooltip(e);
            }

            moveTooltip(e) {
                const tooltip = document.getElementById('tooltip');
                const padding = 20;
                tooltip.style.left = (e.clientX + padding) + 'px';
                tooltip.style.top = (e.clientY + padding) + 'px';
                
                const tooltipRect = tooltip.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                if (tooltipRect.right > windowWidth) {
                    tooltip.style.left = (e.clientX - tooltipRect.width - padding) + 'px';
                }
                
                if (tooltipRect.bottom > windowHeight) {
                    tooltip.style.top = (e.clientY - tooltipRect.height - padding) + 'px';
                }
            }

            hideTooltip() {
                const tooltip = document.getElementById('tooltip');
                tooltip.classList.remove('show');
            }

            selectTrader(trader) {
                if (this.isPlaying || !trader.isIdle) {
                    if (!trader.isIdle) {
                        this.showNotification("‚è≥ –¢–æ—Ä–≥–æ–≤–µ—Ü –≤ –ø—É—Ç–∏", "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç —Ç–æ—Ä–≥–æ–≤—Ü–∞, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤ –ø—É—Ç–∏");
                    }
                    return;
                }
                
                if (this.selectedTrader) {
                    this.selectedTrader.element.classList.remove('selected');
                    this.clearRoutePreview();
                    this.hideRangeIndicators();
                }
                
                this.selectedTrader = trader;
                trader.element.classList.add('selected');
                
                document.getElementById('traderSelectionInfo').innerHTML = `
                    <strong style="color: var(--color-primary);">${trader.name}</strong> –≤ ${this.cities.find(c => c.id === trader.cityId).name}<br>
                    <small style="color: var(--color-text-muted);">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è (–Ω–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ—Ä–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏–∫–ª–∞)</small>
                `;
                
                this.showRangeIndicators(trader);
                this.showPossibleRoutes(trader);
                
                this.showNotification("üó∫Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞", "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–≤–µ—Ç–ª–æ–≥–æ –∫—Ä—É–≥–∞. –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –¥–∞–ª—å–Ω–æ—Å—Ç—å!");
            }

            showRangeIndicators(trader) {
                const startCity = this.cities.find(c => c.id === trader.cityId);
                if (!startCity || !startCity.rangeIndicator) return;
                
                startCity.rangeIndicator.classList.add('show');
                this.showingRange = true;
            }

            hideRangeIndicators() {
                this.cities.forEach(city => {
                    if (city.rangeIndicator) {
                        city.rangeIndicator.classList.remove('show');
                    }
                });
                this.showingRange = false;
            }

            showPossibleRoutes(trader) {
                this.clearRoutePreview();
                
                const startCity = this.cities.find(c => c.id === trader.cityId);
                const availableCities = this.cities.filter(c => 
                    c.isDiscovered && 
                    c.id !== startCity.id &&
                    this.calculateDistance(startCity, c) <= this.merchantRange
                );
                
                availableCities.forEach(city => {
                    city.element.style.border = '2px dashed var(--color-success)';
                    city.element.style.transform = 'translate(-50%, -50%) scale(1.1)';
                });
                
                this.cities.filter(c => 
                    c.isDiscovered && 
                    c.id !== startCity.id &&
                    this.calculateDistance(startCity, c) > this.merchantRange
                ).forEach(city => {
                    city.element.style.border = '2px dashed #555';
                    city.element.style.opacity = '0.6';
                });
            }

            selectCityForRoute(city) {
                if (!this.selectedTrader || this.isPlaying) return;
                if (!city.isDiscovered) {
                    this.showNotification("‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≥–æ—Ä–æ–¥", "–≠—Ç–æ—Ç –≥–æ—Ä–æ–¥ –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç. –ü–æ—Å–µ—Ç–∏—Ç–µ –µ–≥–æ –≤–ø–µ—Ä–≤—ã–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å");
                    return;
                }
                
                const startCity = this.cities.find(c => c.id === this.selectedTrader.cityId);
                const distance = this.calculateDistance(startCity, city);
                
                if (this.routeInProgress.length === 0 && distance > this.merchantRange) {
                    this.showNotification("‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å", 
                        `–¢—Ä–µ–±—É–µ—Ç—Å—è ${Math.round(distance)} —à–∞–≥–æ–≤, –¥–æ—Å—Ç—É–ø–Ω–æ ${this.merchantRange}. 
                        –°–æ–∑–¥–∞–π—Ç–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–∞–ª—å–Ω–æ—Å—Ç–∏!`);
                    return;
                }
                
                if (this.routeInProgress.length > 0) {
                    const lastCity = this.routeInProgress[this.routeInProgress.length - 1];
                    const segmentDistance = this.calculateDistance(lastCity, city);
                    if (segmentDistance > this.merchantRange) {
                        this.showNotification("‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å", 
                            `–¢—Ä–µ–±—É–µ—Ç—Å—è ${Math.round(segmentDistance)} —à–∞–≥–æ–≤, –¥–æ—Å—Ç—É–ø–Ω–æ ${this.merchantRange}`);
                        return;
                    }
                }
                
                if (this.routeInProgress.includes(city)) {
                    const index = this.routeInProgress.indexOf(city);
                    this.routeInProgress.splice(index, 1);
                    this.resetCityAppearance(city);
                } else {
                    if (city.id === startCity.id && this.routeInProgress.length > 0) {
                        this.routeInProgress.push(city);
                        city.element.style.border = '3px solid var(--color-success)';
                        city.element.style.transform = 'translate(-50%, -50%) scale(1.2)';
                        this.showNotification("üîÑ –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç", "–û—Ç–ª–∏—á–Ω–æ! –≠—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç —É–≤–µ–ª–∏—á–∏—Ç –¥–∞–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤!");
                    } else if (city.id !== startCity.id) {
                        this.routeInProgress.push(city);
                        city.element.style.border = '3px solid var(--color-success)';
                        city.element.style.transform = 'translate(-50%, -50%) scale(1.2)';
                    }
                }
                
                this.updateRoutePreview();
                
                if (this.routeInProgress.length > 0) {
                    document.getElementById('selectedRoute').style.display = 'block';
                    
                    const startCityName = startCity.name;
                    const routeNames = this.routeInProgress.map(c => c.name).join(' ‚Üí ');
                    const isCyclic = this.routeInProgress[this.routeInProgress.length - 1].id === startCity.id;
                    document.getElementById('routeCities').innerHTML = 
                        isCyclic ? 
                            `<span style="color: var(--color-success);">üîÑ –¶–ò–ö–õ:</span> ${startCityName} ‚Üí ${routeNames}` :
                            `<span style="color: var(--color-warning);">‚Üî –õ–ò–ù–ò–Ø:</span> ${startCityName} ‚Üí ${routeNames}`;
                    
                    let totalDistance = 0;
                    let previousCity = startCity;
                    for (const currentCity of this.routeInProgress) {
                        totalDistance += this.calculateDistance(previousCity, currentCity);
                        previousCity = currentCity;
                    }
                    
                    let potentialProfit = 0;
                    let profitableDeliveries = 0;
                    
                    if (startCity.resource.id === this.routeInProgress[0].demand.id) {
                        potentialProfit += Math.round(this.routeInProgress[0].currentValue * 1.5);
                        profitableDeliveries++;
                    }
                    
                    for (let i = 1; i < this.routeInProgress.length; i++) {
                        const prevCity = this.routeInProgress[i-1];
                        const currentCity = this.routeInProgress[i];
                        if (prevCity.resource.id === currentCity.demand.id) {
                            potentialProfit += Math.round(currentCity.currentValue * 1.5);
                            profitableDeliveries++;
                        }
                    }
                    
                    document.getElementById('routeDistance').textContent = Math.round(totalDistance);
                    document.getElementById('routeProfit').textContent = potentialProfit;
                    
                    const profitInfo = document.querySelector('#routeDistance').parentNode;
                    if (profitInfo) {
                        const deliveryInfo = profitableDeliveries > 0 ? 
                            `<span style="color: var(--color-success);">–í—ã–≥–æ–¥–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫: ${profitableDeliveries}</span>` :
                            `<span style="color: var(--color-warning);">–ù–µ—Ç –≤—ã–≥–æ–¥–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫</span>`;
                        if (!profitInfo.querySelector('.delivery-info')) {
                            const infoEl = document.createElement('div');
                            infoEl.className = 'delivery-info';
                            infoEl.style.fontSize = '10px';
                            infoEl.style.marginTop = '4px';
                            profitInfo.appendChild(infoEl);
                        }
                        profitInfo.querySelector('.delivery-info').innerHTML = deliveryInfo;
                    }
                } else {
                    document.getElementById('selectedRoute').style.display = 'none';
                }
            }

            resetCityAppearance(city) {
                const startCity = this.selectedTrader ? 
                    this.cities.find(c => c.id === this.selectedTrader.cityId) : null;
                
                if (startCity && city.id !== startCity.id) {
                    const distance = this.calculateDistance(startCity, city);
                    if (distance <= this.merchantRange) {
                        city.element.style.border = '2px dashed var(--color-success)';
                        city.element.style.transform = 'translate(-50%, -50%) scale(1.1)';
                    } else {
                        city.element.style.border = '2px dashed #555';
                        city.element.style.opacity = '0.6';
                    }
                } else {
                    city.element.style.border = '';
                    city.element.style.transform = '';
                    city.element.style.opacity = '';
                }
            }

            calculateDistance(cityA, cityB) {
                const dx = cityA.x - cityB.x;
                const dy = cityA.y - cityB.y;
                return Math.sqrt(dx * dx + dy * dy);
            }

            updateRoutePreview() {
                document.querySelectorAll('.trade-route.preview').forEach(el => el.remove());
                
                if (this.routeInProgress.length === 0 || !this.selectedTrader) return;
                
                const startCity = this.cities.find(c => c.id === this.selectedTrader.cityId);
                let previousCity = startCity;
                
                for (const currentCity of this.routeInProgress) {
                    this.createRouteElement(previousCity, currentCity, true);
                    previousCity = currentCity;
                }
            }

            createRouteElement(cityA, cityB, isPreview = false) {
                const map = document.getElementById('gameMap');
                
                const path = document.createElement('div');
                path.className = `trade-route ${isPreview ? 'preview' : 'active'}`;
                
                const dx = cityB.x - cityA.x;
                const dy = cityB.y - cityA.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                path.style.width = `${length}px`;
                path.style.left = `${cityA.x}px`;
                path.style.top = `${cityA.y}px`;
                path.style.transform = `rotate(${angle}deg)`;
                
                if (!isPreview) {
                    path.dataset.routeId = `${cityA.id}-${cityB.id}`;
                }
                
                map.appendChild(path);
                return path;
            }

            clearRoutePreview() {
                document.querySelectorAll('.trade-route.preview').forEach(el => el.remove());
                this.cities.forEach(city => {
                    if (city.element) {
                        city.element.style.border = '';
                        city.element.style.transform = '';
                        city.element.style.opacity = '';
                    }
                });
                this.routeInProgress = [];
                document.getElementById('selectedRoute').style.display = 'none';
            }

            confirmRoute() {
                if (!this.selectedTrader || this.routeInProgress.length === 0) {
                    this.showNotification("‚ùå –ú–∞—Ä—à—Ä—É—Ç –Ω–µ –≥–æ—Ç–æ–≤", "–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≥–æ—Ä–æ–¥ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è");
                    return;
                }

                const startCity = this.cities.find(c => c.id === this.selectedTrader.cityId);
                const isCyclic = this.routeInProgress[this.routeInProgress.length - 1].id === startCity.id;
                
                const route = {
                    traderId: this.selectedTrader.id,
                    cities: [startCity, ...this.routeInProgress],
                    currentStep: 0,
                    isActive: true,
                    isCyclic: isCyclic,
                    totalDistance: 0,
                    estimatedProfit: 0
                };
                
                route.totalDistance = route.cities.reduce((total, city, index, arr) => {
                    if (index === 0) return total;
                    return total + this.calculateDistance(arr[index-1], city);
                }, 0);
                
                route.estimatedProfit = route.cities.reduce((profit, city, index, arr) => {
                    if (index === 0) return profit;
                    const prevCity = arr[index-1];
                    if (prevCity.resource.id === city.demand.id) {
                        return profit + Math.round(city.currentValue * 1.5);
                    }
                    return profit;
                }, 0);
                
                this.selectedTrader.route = route.cities.map(c => c.id);
                this.selectedTrader.currentPosition = 0;
                this.selectedTrader.isIdle = false;
                this.selectedTrader.isMoving = true;
                this.selectedTrader.element.classList.remove('idle', 'selected');
                
                this.selectedTrader.element.querySelector('.merchant-info').innerHTML = `
                    <div class="tooltip-title">üê´ ${this.selectedTrader.name}</div>
                    <div style="margin-bottom: 5px; color: var(--color-success);">
                        <strong>–í –ø—É—Ç–∏</strong>
                    </div>
                    <div style="font-size: 11px; color: var(--color-text-muted);">
                        –ú–∞—Ä—à—Ä—É—Ç: ${route.cities.map(c => c.name).join(' ‚Üí ')}
                    </div>
                `;
                
                startCity.tradersInCity.delete(this.selectedTrader.id);
                this.updateCityTradersDisplay(startCity);
                
                for (let i = 0; i < route.cities.length - 1; i++) {
                    this.createRouteElement(route.cities[i], route.cities[i + 1]);
                }
                
                this.routes.push(route);
                this.activeTraders++;
                this.availableTraders--;
                
                const routeNames = route.cities.slice(1).map(c => c.name).join(' ‚Üí ');
                const routeType = isCyclic ? "—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π" : "–ª–∏–Ω–µ–π–Ω—ã–π";
                this.logEvent(`${this.getYearText()} - ${this.selectedTrader.name} –Ω–∞—á–∞–ª ${routeType} –º–∞—Ä—à—Ä—É—Ç: ${startCity.name} ‚Üí ${routeNames}`);
                
                if (isCyclic) {
                    this.showNotification("üîÑ –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω", 
                        "–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –¥–∞–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ —É–≤–µ–ª–∏—á–∏—Ç—Å—è –Ω–∞ 50 —à–∞–≥–æ–≤!");
                }
                
                this.clearRoutePreview();
                this.hideRangeIndicators();
                this.selectedTrader = null;
                
                this.updateUI();
                
                this.showNotification("‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω", 
                    `–¢–æ—Ä–≥–æ–≤–µ—Ü –Ω–∞—á–∞–ª ${routeType} –º–∞—Ä—à—Ä—É—Ç (${Math.round(route.totalDistance)} —à–∞–≥–æ–≤). 
                    –°–≤–æ–±–æ–¥–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤: ${this.availableTraders}`);
            }

            cancelRoute() {
                if (this.selectedTrader) {
                    this.selectedTrader.element.classList.remove('selected');
                }
                this.clearRoutePreview();
                this.hideRangeIndicators();
                this.selectedTrader = null;
                document.getElementById('selectedRoute').style.display = 'none';
                document.getElementById('traderSelectionInfo').textContent = "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—Ü–∞ –¥–ª—è –ø—Ä–æ–∫–ª–∞–¥–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞";
            }

            moveTraders() {
                this.routes.forEach(route => {
                    if (!route.isActive) return;
                    
                    const trader = this.traders.find(t => t.id === route.traderId);
                    if (!trader || !trader.isMoving) return;
                    
                    if (trader.isTraveling) {
                        return;
                    }
                    
                    const nextPosition = trader.currentPosition + 1;
                    
                    if (nextPosition >= route.cities.length) {
                        this.completeRoute(trader, route);
                        return;
                    }
                    
                    const currentCity = route.cities[trader.currentPosition];
                    const nextCity = route.cities[nextPosition];
                    
                    trader.isTraveling = true;
                    trader.currentTargetCityId = nextCity.id;
                    
                    currentCity.tradersInCity.delete(trader.id);
                    this.updateCityTradersDisplay(currentCity);
                    
                    this.moveTraderToCity(trader, nextCity);
                    
                    setTimeout(() => {
                        if (!this.isPlaying) return;
                        
                        trader.isTraveling = false;
                        trader.currentPosition = nextPosition;
                        trader.cityId = nextCity.id;
                        
                        nextCity.tradersInCity.add(trader.id);
                        this.updateCityTradersDisplay(nextCity);
                        
                        this.arriveAtCity(trader, currentCity, nextCity);
                        
                    }, 2000 / this.gameSpeed);
                });
                
                document.getElementById('autoRouteBtn').disabled = this.gold < 50 || this.availableTraders === 0;
            }

            moveTraderToCity(trader, city) {
                if (!trader.element) return;
                
                const animationTime = 2000 / this.gameSpeed;
                trader.element.style.transition = `left ${animationTime}ms linear, top ${animationTime}ms linear`;
                trader.element.style.left = `${city.x}px`;
                trader.element.style.top = `${city.y}px`;
                
                city.element.classList.add('has-trader');
            }

            arriveAtCity(trader, fromCity, toCity) {
                fromCity.element.classList.remove('has-trader');
                
                if (trader.cargo && trader.cargo.id === toCity.demand.id) {
                    const profit = Math.round(toCity.currentValue * 1.5);
                    this.gold += profit;
                    trader.goldEarned += profit;
                    
                    this.showProfitAnimation(toCity, `+${profit}üí∞`);
                    
                    this.logEvent(`${this.getYearText()} - ${trader.name} –¥–æ—Å—Ç–∞–≤–∏–ª ${trader.cargo.name} –≤ ${toCity.name} (+${profit}üí∞)`);
                    
                    this.openConnectedCities(toCity);
                }
                
                if (!toCity.visitedBy.has(trader.id)) {
                    toCity.visitedBy.add(trader.id);
                    
                    if (!this.discoveredCities.has(toCity.id)) {
                        this.discoverCity(toCity);
                    }
                    
                    if (!toCity.gaveTrader) {
                        this.addNewTrader(toCity);
                        toCity.gaveTrader = true;
                        
                        this.showNotification("üéâ –ù–û–í–´–ô –ö–ê–†–ê–í–ê–ù–©–ò–ö!", 
                            `${toCity.name} –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å ${this.totalTraders} —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤.`);
                    }
                }
                
                trader.cargo = toCity.resource;
                
                const infoEl = trader.element.querySelector('.merchant-info');
                if (infoEl) {
                    infoEl.innerHTML = `
                        <div class="tooltip-title">üê´ ${trader.name}</div>
                        <div style="margin-bottom: 5px;">
                            <strong>–ì–æ—Ä–æ–¥:</strong> ${toCity.name}
                        </div>
                        <div style="margin-bottom: 5px;">
                            <strong>–ì—Ä—É–∑:</strong> ${trader.cargo.icon} ${trader.cargo.name}
                        </div>
                        <div style="margin-bottom: 5px;">
                            <strong>–ó–∞—Ä–∞–±–æ—Ç–∞–ª:</strong> ${trader.goldEarned}üí∞
                        </div>
                        <div style="font-size: 11px; color: var(--color-text-muted);">
                            –°–ª–µ–¥—É—é—â–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –≥–æ–¥...
                        </div>
                    `;
                }
            }

            showProfitAnimation(city, text) {
                const animation = document.createElement('div');
                animation.className = 'profit-animation';
                animation.textContent = text;
                animation.style.left = `${city.x + this.mapX}px`;
                animation.style.top = `${city.y + this.mapY - 50}px`;
                
                document.querySelector('.game-container').appendChild(animation);
                
                setTimeout(() => {
                    animation.remove();
                }, 2000);
            }

            discoverCity(city) {
                city.isDiscovered = true;
                this.discoveredCities.add(city.id);
                
                const cityEl = city.element;
                cityEl.classList.remove('locked');
                cityEl.classList.add('active');
                
                const eraResources = this.resourcesByEra[city.era];
                const resource = eraResources[Math.floor(Math.random() * eraResources.length)];
                
                let demandResource;
                do {
                    demandResource = eraResources[Math.floor(Math.random() * eraResources.length)];
                } while (demandResource.id === resource.id);
                
                city.resource = resource;
                city.demand = demandResource;
                city.baseValue = resource.value;
                city.currentValue = this.calculateCityValue(city, resource);
                
                cityEl.querySelector('.city-icon').textContent = resource.icon;
                cityEl.querySelector('.city-name').textContent = city.name;
                cityEl.querySelector('.city-demand').innerHTML = `–ù—É–∂–Ω–æ: ${demandResource.icon}`;
                cityEl.querySelector('.city-value').textContent = `${city.currentValue}üí∞`;
                cityEl.style.background = this.getCityGradient(resource.id);
                
                cityEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectCityForRoute(city);
                });
                
                this.showNotification("üó∫Ô∏è –ù–û–í–´–ô –ì–û–†–û–î –û–¢–ö–†–´–¢!", `${city.name} —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏`);
                this.logEvent(`${this.getYearText()} - –û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥: ${city.name}`);
            }

            openConnectedCities(city) {
                const connectedCityIds = this.cityConnections.get(city.id);
                if (!connectedCityIds) return;
                
                let openedCount = 0;
                connectedCityIds.forEach(cityId => {
                    const connectedCity = this.cities[cityId];
                    if (connectedCity && !connectedCity.isDiscovered) {
                        this.discoverCity(connectedCity);
                        openedCount++;
                    }
                });
                
                if (openedCount > 0) {
                    this.showNotification("üåç –û–¢–ö–†–´–¢–´ –ù–û–í–´–ï –ì–û–†–û–î–ê!", `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${city.name} –æ—Ç–∫—Ä—ã–ª–∞ ${openedCount} –Ω–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤`);
                }
            }

            completeRoute(trader, route) {
                trader.isIdle = true;
                trader.isMoving = false;
                trader.isTraveling = false;
                trader.element.classList.add('idle');
                this.availableTraders++;
                this.activeTraders--;
                route.isActive = false;
                
                if (route.isCyclic) {
                    this.merchantRange += 50;
                    this.cities.forEach(city => {
                        if (city.rangeIndicator) {
                            city.rangeIndicator.style.setProperty('--merchant-range', this.merchantRange);
                        }
                    });
                    
                    this.showNotification("üìà –î–ê–õ–¨–ù–û–°–¢–¨ –£–í–ï–õ–ò–ß–ï–ù–ê!", `–¢–µ–ø–µ—Ä—å —Ç–æ—Ä–≥–æ–≤—Ü—ã –º–æ–≥—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å ${this.merchantRange} —à–∞–≥–æ–≤ –∑–∞ —Ö–æ–¥`);
                    this.logEvent(`${this.getYearText()} - ${trader.name} –∑–∞–≤–µ—Ä—à–∏–ª —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç. –î–∞–ª—å–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ ${this.merchantRange} —à–∞–≥–æ–≤!`);
                } else {
                    this.logEvent(`${this.getYearText()} - ${trader.name} –∑–∞–≤–µ—Ä—à–∏–ª –ª–∏–Ω–µ–π–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –≤ ${this.cities.find(c => c.id === trader.cityId).name}`);
                }
                
                document.getElementById('currentRange').textContent = this.merchantRange;
                document.getElementById('routeLengthValue').textContent = this.merchantRange;
                
                if (this.availableTraders === this.totalTraders) {
                    this.stopPlaying();
                }
            }

            addNewTrader(city) {
                const newTraderId = this.traders.length;
                const trader = {
                    id: newTraderId,
                    name: this.getTraderName(newTraderId),
                    cityId: city.id,
                    route: [],
                    currentPosition: 0,
                    isMoving: false,
                    isTraveling: false,
                    cargo: null,
                    goldEarned: 0,
                    element: null,
                    isIdle: true,
                    currentTargetCityId: null
                };
                
                this.traders.push(trader);
                this.totalTraders++;
                this.availableTraders++;
                
                city.tradersInCity.add(trader.id);
                this.updateCityTradersDisplay(city);
                
                this.createTraderElement(trader);
                
                this.logEvent(`${this.getYearText()} - –ù–æ–≤—ã–π –∫–∞—Ä–∞–≤–∞–Ω—â–∏–∫ ${trader.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –≤ ${city.name}`);
            }

            getTraderName(id) {
                const names = [
                    "–•–∞–º–º—É—Ä–∞–ø–∏", "–°–∞—Ä–≥–æ–Ω", "–†–∞–º—Å–µ—Å", "–¢—É—Ç–º–æ—Å", "–ö–∏—Ä", "–î–∞—Ä–∏–π",
                    "–ü–µ—Ä–∏–∫–ª", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", "–¶–µ–∑–∞—Ä—å", "–ê–≤–≥—É—Å—Ç", "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω", "–Æ—Å—Ç–∏–Ω–∏–∞–Ω",
                    "–ö–∞—Ä–ª –í–µ–ª–∏–∫–∏–π", "–†–∏—á–∞—Ä–¥", "–§—Ä–∏–¥—Ä–∏—Ö", "–ì–µ–Ω—Ä–∏—Ö", "–§–µ—Ä–¥–∏–Ω–∞–Ω–¥", "–ò–∑–∞–±–µ–ª–ª–∞",
                    "–ö–æ–ª—É–º–±", "–ú–∞–≥–µ–ª–ª–∞–Ω", "–í–∞—Å–∫–æ –¥–∞ –ì–∞–º–∞", "–ö–æ—Ä—Ç–µ—Å", "–ù–∞–ø–æ–ª–µ–æ–Ω", "–í–µ–ª–ª–∏–Ω–≥—Ç–æ–Ω",
                    "–†–æ–∫—Ñ–µ–ª–ª–µ—Ä", "–ö–∞—Ä–Ω–µ–≥–∏", "–§–æ—Ä–¥", "–≠–¥–∏—Å–æ–Ω", "–¢–µ—Å–ª–∞", "–ì–µ–π—Ç—Å", "–î–∂–æ–±—Å"
                ];
                return names[id] || `–¢–æ—Ä–≥–æ–≤–µ—Ü ${id + 1}`;
            }

            processYear() {
                if (this.gameOver) return;
                
                this.year++;
                
                if (this.year >= 2020) {
                    this.endGame('time');
                    return;
                }
                
                this.updateEra();
                
                const upkeep = this.calculateUpkeep();
                this.gold -= upkeep;
                
                if (upkeep > 0) {
                    this.logEvent(`${this.getYearText()} - –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: -${upkeep}üí∞ (${this.traders.length} —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤, ${this.discoveredCities.size} –≥–æ—Ä–æ–¥–æ–≤)`);
                }
                
                if (this.gold <= 0) {
                    this.gold = 0;
                    this.endGame('bankruptcy');
                    return;
                }
                
                this.moveTraders();
                
                if (Math.random() < 0.05 && this.year - this.lastEventYear > 100) {
                    this.generateEvent();
                }
                
                this.updateUI();
            }

            calculateUpkeep() {
                const tradersCost = this.traders.length * this.upkeepPerTrader;
                const citiesCost = this.discoveredCities.size * this.upkeepPerCity;
                return tradersCost + citiesCost;
            }

            playPause() {
                if (this.gameOver) return;
                
                if (!this.isPlaying) {
                    if (this.activeTraders === 0) {
                        this.showNotification("‚ö†Ô∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤", "–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç –¥–ª—è —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤");
                        return;
                    }
                    
                    if (this.availableTraders > 0) {
                        document.getElementById('freeTradersCount').textContent = this.availableTraders;
                        document.getElementById('confirmModal').classList.add('active');
                        return;
                    }
                    
                    this.startPlaying();
                } else {
                    this.stopPlaying();
                }
            }

            startPlaying() {
                const upkeep = this.calculateUpkeep();
                if (this.gold < upkeep) {
                    this.showNotification("üíÄ –ë–ê–ù–ö–†–û–¢–°–¢–í–û!", "–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ –∏ –≥–æ—Ä–æ–¥–æ–≤");
                    this.endGame('bankruptcy');
                    return;
                }
                
                this.isPlaying = true;
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i><span>–ü–ê–£–ó–ê</span>';
                document.getElementById('playPauseBtn').style.background = 'linear-gradient(135deg, #8b0000, #660000)';
                
                const statusEl = document.querySelector('.status-indicator') || (() => {
                    const el = document.createElement('div');
                    el.className = 'status-indicator';
                    document.querySelector('.game-title').appendChild(el);
                    return el;
                })();
                statusEl.className = 'status-indicator status-playing';
                statusEl.innerHTML = '<i class="fas fa-play"></i> –ò–î–Å–¢ –í–†–ï–ú–Ø';
                
                this.gameLoop = setInterval(() => this.processYear(), this.yearProcessingTime / this.gameSpeed);
                
                this.showNotification("‚ñ∂Ô∏è –≠–ü–û–•–ê –ù–ê–ß–ê–õ–ê–°–¨", `–í—Ä–µ–º—è –∏–¥—ë—Ç —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é ${this.gameSpeed}x. –¢–æ—Ä–≥–æ–≤—Ü—ã –≤ –ø—É—Ç–∏...`);
            }

            stopPlaying() {
                this.isPlaying = false;
                clearInterval(this.gameLoop);
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i><span>–ü–†–û–î–û–õ–ñ–ò–¢–¨</span>';
                document.getElementById('playPauseBtn').style.background = 'linear-gradient(135deg, var(--color-primary), #b8860b)';
                
                const statusEl = document.querySelector('.status-indicator');
                if (statusEl) {
                    statusEl.className = 'status-indicator status-paused';
                    statusEl.innerHTML = '<i class="fas fa-pause"></i> –ù–ê –ü–ê–£–ó–ï';
                }
                
                this.showNotification("‚è∏Ô∏è –≠–ü–û–•–ê –ù–ê –ü–ê–£–ó–ï", "–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤");
            }

            setGameSpeed(speed) {
                this.gameSpeed = speed;
                document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                if (this.isPlaying) {
                    clearInterval(this.gameLoop);
                    this.gameLoop = setInterval(() => this.processYear(), this.yearProcessingTime / this.gameSpeed);
                }
                
                this.showNotification(`‚ö° –°–∫–æ—Ä–æ—Å—Ç—å ${speed}x`, `–í—Ä–µ–º—è —Ç–µ–ø–µ—Ä—å –∏–¥—ë—Ç –≤ ${speed} —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ`);
            }

            confirmContinue() {
                document.getElementById('confirmModal').classList.remove('active');
                this.startPlaying();
            }

            cancelContinue() {
                document.getElementById('confirmModal').classList.remove('active');
                this.showNotification("üîÑ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤", "–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –¥–ª—è –Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ã");
            }

            autoRoute() {
                if (this.gold < 50 || this.availableTraders === 0) {
                    this.showNotification("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤", "–ù—É–∂–Ω–æ 50üí∞ –∏ —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–æ—Ä–≥–æ–≤–µ—Ü");
                    return;
                }
                
                this.gold -= 50;
                
                const idleTrader = this.traders.find(t => t.isIdle);
                if (!idleTrader) return;
                
                this.selectTrader(idleTrader);
                
                const startCity = this.cities.find(c => c.id === idleTrader.cityId);
                const availableCities = this.cities.filter(c => 
                    c.isDiscovered && 
                    c.id !== startCity.id &&
                    this.calculateDistance(startCity, c) <= this.merchantRange &&
                    !c.gaveTrader
                );
                
                if (availableCities.length === 0) {
                    this.cities.filter(c => 
                        c.isDiscovered && 
                        c.id !== startCity.id &&
                        this.calculateDistance(startCity, c) <= this.merchantRange
                    );
                }
                
                const bestCities = [...availableCities]
                    .sort((a, b) => {
                        const startCityResource = startCity.resource.id;
                        const aScore = (a.demand.id === startCityResource ? 200 : 0) + 
                                     (a.gaveTrader ? 0 : 100) +
                                     a.currentValue;
                        const bScore = (b.demand.id === startCityResource ? 200 : 0) + 
                                     (b.gaveTrader ? 0 : 100) + 
                                     b.currentValue;
                        return bScore - aScore;
                    })
                    .slice(0, 2);
                
                if (bestCities.length > 0) {
                    this.clearRoutePreview();
                    this.routeInProgress = bestCities;
                    
                    bestCities.forEach(city => {
                        city.element.style.border = '3px solid var(--color-success)';
                        city.element.style.transform = 'translate(-50%, -50%) scale(1.2)';
                    });
                    this.updateRoutePreview();
                    
                    setTimeout(() => {
                        if (this.routeInProgress.length > 0) {
                            this.confirmRoute();
                            this.showNotification("ü§ñ –ê–≤—Ç–æ-–º–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω", 
                                `–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–∏–ª –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∑–∞ 50üí∞. 
                                ${bestCities.some(c => c.demand.id === startCity.resource.id) ? 
                                    '–í–∫–ª—é—á–∞–µ—Ç –≤—ã–≥–æ–¥–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏!' : 
                                    '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –≤—Ä—É—á–Ω—É—é –¥–ª—è –±–æ–ª—å—à–µ–π –ø—Ä–∏–±—ã–ª–∏.'}`);
                        }
                    }, 500);
                } else {
                    this.showNotification("‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤", "–ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Å—è–≥–∞–µ–º–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤—Ü–∞");
                    this.gold += 50;
                }
            }

            updateEra() {
                const newEra = this.eras.findIndex(era => this.year >= era.start && this.year <= era.end);
                if (newEra !== -1 && newEra !== this.currentEra) {
                    this.currentEra = newEra;
                    const era = this.eras[this.currentEra];
                    
                    document.getElementById('eraName').textContent = era.name;
                    document.getElementById('eraYears').textContent = 
                        `${Math.abs(era.start)} ${era.start < 0 ? '–≥–≥. –¥–æ –Ω.—ç.' : '–≥–≥.'} - ${era.end} –≥–≥.`;
                    
                    this.updateCityResources();
                    
                    this.showNotification(`${era.icon} –ù–û–í–ê–Ø –≠–ü–û–•–ê: ${era.name}`, 
                        `–ù–∞—Å—Ç—É–ø–∏–ª–∞ –Ω–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —ç–ø–æ—Ö–∞. –¢–æ—Ä–≥–æ–≤–ª—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å!`);
                    this.logEvent(`${this.getYearText()} - –ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ ${era.name}`);
                }
            }

            updateCityResources() {
                this.cities.forEach(city => {
                    if (city.era <= this.currentEra && city.isDiscovered) {
                        const eraResources = this.resourcesByEra[city.era];
                        const resource = eraResources[Math.floor(Math.random() * eraResources.length)];
                        
                        let demandResource;
                        do {
                            demandResource = eraResources[Math.floor(Math.random() * eraResources.length)];
                        } while (demandResource.id === resource.id);
                        
                        city.resource = resource;
                        city.demand = demandResource;
                        city.baseValue = resource.value;
                        city.currentValue = this.calculateCityValue(city, resource);
                        
                        if (city.element) {
                            city.element.querySelector('.city-icon').textContent = resource.icon;
                            city.element.querySelector('.city-demand').innerHTML = 
                                `–ù—É–∂–Ω–æ: ${demandResource.icon}`;
                            city.element.querySelector('.city-value').textContent = `${city.currentValue}üí∞`;
                            city.element.style.background = this.getCityGradient(resource.id);
                        }
                    }
                });
            }

            generateEvent() {
                const events = [
                    {
                        title: "‚öîÔ∏è –í–û–ô–ù–ê!",
                        message: "–í–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–µ—Ä–µ–∫—Ä—ã–ª —Ç–æ—Ä–≥–æ–≤—ã–µ –ø—É—Ç–∏. –î–æ—Ö–æ–¥ —Å–Ω–∏–∂–µ–Ω –Ω–∞ 20%.",
                        effect: () => {
                            this.cities.forEach(city => {
                                city.currentValue = Math.round(city.currentValue * 0.8);
                            });
                        }
                    },
                    {
                        title: "üåæ –£–†–û–ñ–ê–ô!",
                        message: "–ù–µ–±—ã–≤–∞–ª—ã–π —É—Ä–æ–∂–∞–π –ø—à–µ–Ω–∏—Ü—ã. –¶–µ–Ω—ã –Ω–∞ –∑–µ—Ä–Ω–æ –≤—ã—Ä–æ—Å–ª–∏!",
                        effect: () => {
                            this.cities.forEach(city => {
                                if (city.resource.id === 'grain') {
                                    city.currentValue = Math.round(city.currentValue * 1.5);
                                }
                            });
                        }
                    },
                    {
                        title: "üõ≥Ô∏è –û–¢–ö–†–´–¢–ò–ï!",
                        message: "–û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π –ø—É—Ç—å. –î–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ —É–≤–µ–ª–∏—á–µ–Ω–∞!",
                        effect: () => {
                            this.merchantRange += 100;
                            this.cities.forEach(city => {
                                if (city.rangeIndicator) {
                                    city.rangeIndicator.style.setProperty('--merchant-range', this.merchantRange);
                                }
                            });
                        }
                    },
                    {
                        title: "üíÄ –ß–£–ú–ê!",
                        message: "–≠–ø–∏–¥–µ–º–∏—è –æ–ø—É—Å—Ç–æ—à–∏–ª–∞ –≥–æ—Ä–æ–¥–∞. –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É–¥–≤–æ–µ–Ω–æ –Ω–∞ 10 –ª–µ—Ç.",
                        effect: () => {
                            this.upkeepPerCity *= 2;
                            setTimeout(() => {
                                this.upkeepPerCity /= 2;
                            }, 10000);
                        }
                    },
                    {
                        title: "üèõÔ∏è –†–ï–ù–ï–°–°–ê–ù–°!",
                        message: "–ö—É–ª—å—Ç—É—Ä–Ω—ã–π —Ä–∞—Å—Ü–≤–µ—Ç –ø—Ä–∏–≤–ª—ë–∫ –Ω–æ–≤—ã—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤.",
                        effect: () => {
                            const idleTraders = this.traders.filter(t => t.isIdle);
                            if (idleTraders.length < 3) {
                                this.availableTraders++;
                                this.totalTraders++;
                            }
                        }
                    }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                this.showNotification(event.title, event.message);
                event.effect();
                
                this.lastEventYear = this.year;
                this.logEvent(`${this.getYearText()} - ${event.message}`);
            }

            showTutorial() {
                document.getElementById('tutorialModal').classList.add('active');
                this.showTutorialStep(1);
            }

            showTutorialStep(step) {
                this.tutorialStep = step;
                for (let i = 1; i <= 4; i++) {
                    document.getElementById(`tutorialStep${i}`).style.display = i === step ? 'block' : 'none';
                }
                
                this.highlightTutorialElements(step);
            }

            highlightTutorialElements(step) {
                document.querySelectorAll('.tutorial-highlight').forEach(el => {
                    el.classList.remove('tutorial-highlight');
                });
                
                switch(step) {
                    case 2:
                        const cities = document.querySelectorAll('.city.active');
                        if (cities.length > 0) {
                            cities[0].classList.add('tutorial-highlight');
                        }
                        break;
                    case 3:
                        const trader = document.querySelector('.merchant');
                        if (trader) {
                            trader.classList.add('tutorial-highlight');
                        }
                        break;
                }
            }

            nextTutorialStep() {
                if (this.tutorialStep < 4) {
                    this.showTutorialStep(this.tutorialStep + 1);
                }
            }

            prevTutorialStep() {
                if (this.tutorialStep > 1) {
                    this.showTutorialStep(this.tutorialStep - 1);
                }
            }

            skipTutorial() {
                this.isTutorialCompleted = true;
                localStorage.setItem('tutorialCompleted', 'true');
                document.getElementById('tutorialModal').classList.remove('active');
                this.showNotification("üèõÔ∏è –î–†–ï–í–ù–û–°–¢–¨ –ù–ê–ß–ê–õ–ê–°–¨", "3000 –ª–µ—Ç –¥–æ –Ω.—ç. 5 –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏.");
                this.logEvent("3000 –≥. –¥–æ –Ω.—ç. - –ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ –î—Ä–µ–≤–Ω–æ—Å—Ç–∏");
                this.logEvent("–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞: –£—Ä, –ú–µ–º—Ñ–∏—Å, –í–∞–≤–∏–ª–æ–Ω, –ù–∏–Ω–µ–≤–∏—è, –°—É–∑—ã");
            }

            startGame() {
                this.isTutorialCompleted = true;
                localStorage.setItem('tutorialCompleted', 'true');
                document.getElementById('tutorialModal').classList.remove('active');
                this.showNotification("üèõÔ∏è –î–†–ï–í–ù–û–°–¢–¨ –ù–ê–ß–ê–õ–ê–°–¨", "3000 –ª–µ—Ç –¥–æ –Ω.—ç. 5 –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏.");
                this.logEvent("3000 –≥. –¥–æ –Ω.—ç. - –ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ –î—Ä–µ–≤–Ω–æ—Å—Ç–∏");
                this.logEvent("–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞: –£—Ä, –ú–µ–º—Ñ–∏—Å, –í–∞–≤–∏–ª–æ–Ω, –ù–∏–Ω–µ–≤–∏—è, –°—É–∑—ã");
                
                const firstTrader = document.querySelector('.merchant');
                if (firstTrader) {
                    firstTrader.classList.add('tutorial-highlight');
                    setTimeout(() => {
                        firstTrader.classList.remove('tutorial-highlight');
                    }, 5000);
                }
            }

            endGame(reason) {
                this.gameOver = true;
                this.isPlaying = false;
                clearInterval(this.gameLoop);
                
                const finalScore = this.gold + (this.totalTraders * 100) + (this.discoveredCities.size * 50);
                let title = '';
                let message = '';
                
                if (reason === 'bankruptcy') {
                    title = 'üíÄ –ë–ê–ù–ö–†–û–¢–°–¢–í–û!';
                    message = '–í–∞—à–∞ –∫–∞–∑–Ω–∞ –æ–ø—É—Å—Ç–µ–ª–∞. –¢–æ—Ä–≥–æ–≤–ª—è –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∞—Å—å.';
                } else {
                    title = 'üèÅ –ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê!';
                    message = '–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 2020 –≥–æ–¥–∞. –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...';
                }
                
                const highScore = localStorage.getItem('highScore') || 0;
                if (finalScore > highScore) {
                    localStorage.setItem('highScore', finalScore);
                    message += '\nüèÜ –£–°–¢–ê–ù–û–í–õ–ï–ù –ù–û–í–´–ô –†–ï–ö–û–†–î!';
                }
                
                document.getElementById('finalGold').textContent = this.gold;
                document.getElementById('finalRoutes').textContent = this.routes.length;
                document.getElementById('finalTraders').textContent = this.totalTraders;
                document.getElementById('finalScore').textContent = finalScore;
                document.getElementById('resultsTitle').textContent = title;
                document.getElementById('resultsMessage').innerHTML = message.replace('\n', '<br>');
                
                document.getElementById('strategyAnalysis').innerHTML = this.generateStrategyAnalysis();
                
                setTimeout(() => {
                    document.getElementById('resultsModal').classList.add('active');
                }, 1000);
            }

            generateStrategyAnalysis() {
                const totalDistance = this.routes.reduce((sum, route) => {
                    return sum + route.cities.reduce((dist, city, i, arr) => {
                        return i > 0 ? dist + this.calculateDistance(arr[i-1], city) : dist;
                    }, 0);
                }, 0);
                
                const cyclicRoutes = this.routes.filter(r => r.isCyclic).length;
                
                let analysis = `
                    <p>–í—ã —É–ø—Ä–∞–≤–ª—è–ª–∏ —Ç–æ—Ä–≥–æ–≤–ª–µ–π —á–µ—Ä–µ–∑ ${Math.min(this.currentEra + 1, this.eras.length)} –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —ç–ø–æ—Ö.</p>
                    <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å: <strong>${this.merchantRange} —à–∞–≥–æ–≤</strong></p>
                    <p>–û–±—â–∞—è –ø—Ä–æ–π–¥–µ–Ω–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è: <strong>${Math.round(totalDistance)} —à–∞–≥–æ–≤</strong></p>
                    <p>–¶–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤: <strong>${cyclicRoutes}</strong> (—É–≤–µ–ª–∏—á–∏–≤–∞–ª–∏ –¥–∞–ª—å–Ω–æ—Å—Ç—å)</p>
                `;
                
                if (this.totalTraders < 5) {
                    analysis += '<div class="strategy-tip">';
                    analysis += '<h4><i class="fas fa-users"></i> –ù–£–ñ–ù–û –ë–û–õ–¨–®–ï –¢–û–†–ì–û–í–¶–ï–í</h4>';
                    analysis += '<p>–ü–æ—Å–µ—â–∞–π—Ç–µ –≥–æ—Ä–æ–¥–∞ –≤–ø–µ—Ä–≤—ã–µ - –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥ –¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞!</p>';
                    analysis += '</div>';
                }
                
                if (cyclicRoutes < this.routes.length / 2) {
                    analysis += '<div class="strategy-tip">';
                    analysis += '<h4><i class="fas fa-redo"></i> –°–û–ó–î–ê–í–ê–ô–¢–ï –¶–ò–ö–õ–ò–ß–ï–°–ö–ò–ï –ú–ê–†–®–†–£–¢–´</h4>';
                    analysis += '<p>–¢–æ—Ä–≥–æ–≤—Ü—ã, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ—Å—è –≤ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥, —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –¥–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö.</p>';
                    analysis += '</div>';
                }
                
                const discoveredPercent = Math.round((this.discoveredCities.size / this.cities.length) * 100);
                analysis += `<p>–û—Ç–∫—Ä—ã—Ç–æ –≥–æ—Ä–æ–¥–æ–≤: <strong>${discoveredPercent}%</strong> (${this.discoveredCities.size} –∏–∑ ${this.cities.length})</p>`;
                
                return analysis;
            }

            getYearText() {
                return this.year < 0 ? `${Math.abs(this.year)} –≥. –¥–æ –Ω.—ç.` : `${this.year} –≥.`;
            }

            logEvent(text) {
                const eventLog = document.getElementById('eventLog');
                const eventDiv = document.createElement('div');
                eventDiv.style.cssText = `
                    padding: 8px;
                    margin-bottom: 5px;
                    background: rgba(58, 44, 0, 0.4);
                    border-radius: 4px;
                    border-left: 3px solid var(--color-primary);
                    font-size: 12px;
                    color: var(--color-text);
                `;
                eventDiv.textContent = text;
                
                eventLog.insertBefore(eventDiv, eventLog.firstChild);
                
                if (eventLog.children.length > 20) {
                    eventLog.removeChild(eventLog.lastChild);
                }
            }

            showNotification(title, message) {
                const notification = document.getElementById('notification');
                document.getElementById('notificationTitle').textContent = title;
                document.getElementById('notificationMessage').textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }

            setupEventListeners() {
                document.getElementById('playPauseBtn').addEventListener('click', () => this.playPause());
                document.getElementById('autoRouteBtn').addEventListener('click', () => this.autoRoute());
                document.getElementById('confirmRouteBtn').addEventListener('click', () => this.confirmRoute());
                document.getElementById('cancelRouteBtn').addEventListener('click', () => this.cancelRoute());
                document.getElementById('confirmContinueBtn').addEventListener('click', () => this.confirmContinue());
                document.getElementById('cancelContinueBtn').addEventListener('click', () => this.cancelContinue());
                document.querySelector('.notification-close').addEventListener('click', () => {
                    document.getElementById('notification').classList.remove('show');
                });
                
                document.querySelectorAll('.speed-btn').forEach((btn, index) => {
                    btn.addEventListener('click', (e) => {
                        this.setGameSpeed(index + 1);
                    });
                });
                
                document.getElementById('notification').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('notification')) {
                        document.getElementById('notification').classList.remove('show');
                    }
                });
                
                // –û–±—É—á–µ–Ω–∏–µ
                document.getElementById('skipTutorialBtn').addEventListener('click', () => this.skipTutorial());
                document.getElementById('nextTutorialBtn').addEventListener('click', () => this.nextTutorialStep());
                document.getElementById('prevTutorialBtn1').addEventListener('click', () => this.prevTutorialStep());
                document.getElementById('nextTutorialBtn2').addEventListener('click', () => this.nextTutorialStep());
                document.getElementById('prevTutorialBtn2').addEventListener('click', () => this.prevTutorialStep());
                document.getElementById('nextTutorialBtn3').addEventListener('click', () => this.nextTutorialStep());
                document.getElementById('prevTutorialBtn3').addEventListener('click', () => this.prevTutorialStep());
                document.getElementById('startGameBtn').addEventListener('click', () => this.startGame());
                
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.tooltip') && !e.target.closest('.city') && !e.target.closest('.merchant')) {
                        this.hideTooltip();
                    }
                });
            }

            updateUI() {
                document.getElementById('yearNumber').textContent = Math.abs(this.year);
                document.getElementById('yearNumber').nextElementSibling.textContent = 
                    this.year < 0 ? '–î–û –ù–ê–®–ï–ô –≠–†–´' : '';
                
                document.getElementById('statGold').textContent = this.gold;
                document.getElementById('statTraders').textContent = `${this.availableTraders}/${this.totalTraders}`;
                document.getElementById('statActiveTraders').textContent = this.activeTraders;
                document.getElementById('statCities').textContent = `${this.discoveredCities.size}/${this.cities.length}`;
                
                document.getElementById('goldValue').textContent = this.gold;
                document.getElementById('freeTradersValue').textContent = this.availableTraders;
                document.getElementById('routeLengthValue').textContent = this.merchantRange;
                
                document.getElementById('currentRange').textContent = this.merchantRange;
                
                if (this.gold < 100) {
                    document.getElementById('goldValue').style.color = '#8b0000';
                    document.getElementById('statGold').style.color = '#8b0000';
                    document.getElementById('goldValue').style.animation = this.isPlaying ? 'pulse 1s infinite' : 'none';
                } else if (this.gold < 300) {
                    document.getElementById('goldValue').style.color = '#ffa500';
                    document.getElementById('statGold').style.color = '#ffa500';
                    document.getElementById('goldValue').style.animation = 'none';
                } else {
                    document.getElementById('goldValue').style.color = 'var(--color-primary)';
                    document.getElementById('statGold').style.color = 'var(--color-primary)';
                    document.getElementById('goldValue').style.animation = 'none';
                }
                
                document.getElementById('autoRouteBtn').disabled = this.gold < 50 || this.availableTraders === 0;
                document.getElementById('playPauseBtn').disabled = this.activeTraders === 0;
                
                const upkeep = this.calculateUpkeep();
                const upkeepInfo = document.getElementById('upkeepInfo') || (() => {
                    const el = document.createElement('div');
                    el.id = 'upkeepInfo';
                    el.className = 'upkeep-info';
                    document.querySelector('.era-display').appendChild(el);
                    return el;
                })();
                upkeepInfo.textContent = `–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: ${upkeep}üí∞/–≥–æ–¥`;
                
                if (this.gold < upkeep * 5 && this.isPlaying) {
                    this.showNotification("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï", `–£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω–µ–µ 5 –ª–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è! –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${this.gold}üí∞`);
                }
            }
        }

        let game;
        window.addEventListener('load', () => {
            game = new HistoricalTradingGame();
        });
    </script>
</body>
</html>