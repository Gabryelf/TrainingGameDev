<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î—Ä–µ–≤–Ω–∏–µ –ê–ª–≥–æ—Ä–∏—Ç–º—ã | –¢–æ—Ä–≥–æ–≤—ã–π –°–∏–º—É–ª—è—Ç–æ—Ä</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'Ancient';
            src: url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        }

        :root {
            --color-bg: #1a1200;
            --color-surface: #2a1e00;
            --color-card: #3a2c00;
            --color-primary: #d4af37;
            --color-success: #8b7355;
            --color-warning: #c19a6b;
            --color-danger: #8b0000;
            --color-info: #b8860b;
            --color-text: #f5deb3;
            --color-text-muted: #cd853f;
            --border-radius: 8px;
            --font-main: 'Cinzel', serif;
        }

        body {
            background: 
                radial-gradient(ellipse at center, #0f0a00 0%, #1a1200 70%),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="parchment" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%231a1200"/><path d="M0,50 Q25,40 50,50 T100,50" stroke="%233a2c00" stroke-width="1" fill="none" opacity="0.2"/><path d="M50,0 Q40,25 50,50 T50,100" stroke="%233a2c00" stroke-width="1" fill="none" opacity="0.2"/></pattern></defs></svg>');
            color: var(--color-text);
            min-height: 100vh;
            overflow: hidden;
            padding: 16px;
            font-family: var(--font-main);
        }

        .game-container {
            max-width: 1400px;
            height: calc(100vh - 32px);
            margin: 0 auto;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 16px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="stone" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%232a1e00"/><path d="M0,20 L100,20 M0,40 L100,40 M0,60 L100,60 M0,80 L100,80" stroke="%233a2c00" stroke-width="2"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 16px 24px;
            border: 2px solid var(--color-primary);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(212, 175, 55, 0.1);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 24px;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="crack" patternUnits="userSpaceOnUse" width="20" height="20"><path d="M0,20 L20,0 M5,20 L20,5 M10,20 L20,10" stroke="%238b7355" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100%" height="100%" fill="url(%23crack)"/></svg>');
            pointer-events: none;
        }

        .game-title {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .game-title h1 {
            font-size: 28px;
            background: linear-gradient(90deg, var(--color-primary), #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
        }

        .era-display {
            text-align: center;
            min-width: 180px;
            background: rgba(42, 30, 0, 0.7);
            padding: 10px 20px;
            border-radius: 6px;
            border: 1px solid var(--color-primary);
        }

        .era-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .era-year {
            font-size: 14px;
            color: var(--color-text-muted);
        }

        .year-display {
            text-align: center;
            min-width: 120px;
            background: rgba(42, 30, 0, 0.7);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--color-primary);
        }

        .year-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .year-label {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        .main-area {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 16px;
            height: 100%;
            overflow: hidden;
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
        }

        .stats-section {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="wood" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%232a1e00"/><path d="M0,0 L100,100 M0,100 L100,0" stroke="%233a2c00" stroke-width="1" opacity="0.2"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 20px;
            border: 2px solid var(--color-primary);
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--color-primary);
            padding-bottom: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: rgba(58, 44, 0, 0.6);
            border-radius: 6px;
            padding: 14px;
            text-align: center;
            border: 1px solid var(--color-text-muted);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-primary), transparent);
        }

        .stat-card:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--color-primary);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .stat-label {
            font-size: 11px;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –ö–∞—Ä—Ç–∞ */
        .map-section {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="ancientMap" patternUnits="userSpaceOnUse" width="200" height="200"><rect width="200" height="200" fill="%232a1e00"/><path d="M20,20 L180,20 M20,40 L180,40 M20,60 L180,60 M20,80 L180,80 M20,100 L180,100 M20,120 L180,120 M20,140 L180,140 M20,160 L180,160 M20,180 L180,180 M40,20 L40,180 M60,20 L60,180 M80,20 L80,180 M100,20 L100,180 M120,20 L120,180 M140,20 L140,180 M160,20 L160,180" stroke="%233a2c00" stroke-width="1" opacity="0.2"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 20px;
            border: 2px solid var(--color-primary);
            box-shadow: 
                inset 0 0 30px rgba(0, 0, 0, 0.7),
                0 4px 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .map-controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .map-control-btn {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: rgba(58, 44, 0, 0.9);
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .map-control-btn:hover {
            background: var(--color-primary);
            color: #1a1200;
            transform: scale(1.1);
        }

        .map-container-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            border-radius: 6px;
            cursor: grab;
            border: 1px solid var(--color-text-muted);
        }

        .map-container-wrapper:active {
            cursor: grabbing;
        }

        #gameMap {
            width: 1600px;
            height: 1200px;
            background: rgba(26, 18, 0, 0.7);
            position: relative;
            transform-origin: 0 0;
            transition: transform 0.1s ease;
        }

        /* –ì–æ—Ä–æ–¥–∞ */
        .city {
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 10;
            border: 3px solid transparent;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .city.locked {
            opacity: 0.3;
            filter: grayscale(1);
            cursor: not-allowed;
        }

        .city.active {
            border-color: var(--color-primary);
        }

        .city.has-trader {
            animation: cityPulse 2s infinite;
        }

        @keyframes cityPulse {
            0% { 
                box-shadow: 
                    0 0 0 0 rgba(212, 175, 55, 0.7),
                    0 4px 20px rgba(0, 0, 0, 0.5); 
            }
            70% { 
                box-shadow: 
                    0 0 0 15px rgba(212, 175, 55, 0),
                    0 4px 20px rgba(0, 0, 0, 0.5); 
            }
            100% { 
                box-shadow: 
                    0 0 0 0 rgba(212, 175, 55, 0),
                    0 4px 20px rgba(0, 0, 0, 0.5); 
            }
        }

        .city-icon {
            font-size: 36px;
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
        }

        .city-name {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 2px;
            text-align: center;
            color: var(--color-primary);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        .city-info {
            font-size: 11px;
            text-align: center;
            line-height: 1.3;
        }

        .city-demand {
            color: var(--color-warning);
            font-weight: 600;
            background: rgba(58, 44, 0, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            margin: 2px 0;
            border: 1px solid var(--color-warning);
            display: inline-block;
        }

        .city-traders {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--color-primary);
            color: #1a1200;
            font-size: 12px;
            font-weight: bold;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1a1200;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* –¢–æ—Ä–≥–æ–≤—ã–µ –ø—É—Ç–∏ */
        .trade-route {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), transparent);
            border-radius: 2px;
            transform-origin: 0 0;
            z-index: 5;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .trade-route.active {
            background: linear-gradient(90deg, var(--color-success), var(--color-primary));
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .trade-route.preview {
            background: rgba(212, 175, 55, 0.5);
            border: 1px dashed var(--color-primary);
        }

        .merchant {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-warning), #8b7355);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transform: translate(-50%, -50%);
            z-index: 20;
            transition: left 2s linear, top 2s linear;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.5),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
            border: 2px solid var(--color-primary);
            cursor: pointer;
        }

        .merchant.idle {
            animation: merchantFloat 3s infinite ease-in-out;
            background: linear-gradient(135deg, var(--color-primary), #b8860b);
        }

        @keyframes merchantFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-5px); }
        }

        .merchant.selected {
            border-color: var(--color-success);
            box-shadow: 0 0 20px rgba(139, 115, 85, 0.8);
            animation: merchantSelected 1s infinite;
        }

        @keyframes merchantSelected {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .footer {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.9), rgba(26, 18, 0, 0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="marble" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%232a1e00"/><path d="M0,0 Q25,15 50,0 T100,0" stroke="%233a2c00" stroke-width="2" fill="none" opacity="0.3"/></pattern></defs></svg>');
            border-radius: var(--border-radius);
            padding: 16px 24px;
            border: 2px solid var(--color-primary);
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 24px;
            align-items: center;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .resource-display {
            display: flex;
            gap: 20px;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 16px;
            background: rgba(58, 44, 0, 0.6);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid var(--color-text-muted);
            min-width: 180px;
        }

        .resource-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--color-primary), #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .resource-info {
            display: flex;
            flex-direction: column;
        }

        .resource-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .resource-label {
            font-size: 12px;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
        }

        .action-btn {
            padding: 16px 32px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 180px;
            justify-content: center;
            font-family: var(--font-main);
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--color-primary), #b8860b);
            color: #1a1200;
        }

        .action-btn.primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.5);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, rgba(42, 30, 0, 0.95), rgba(26, 18, 0, 0.95));
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 20px;
            min-width: 300px;
            max-width: 400px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-message {
            font-size: 14px;
            color: var(--color-text);
            line-height: 1.5;
        }

        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .notification-close:hover {
            background: var(--color-primary);
            color: #1a1200;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 7, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: 
                linear-gradient(135deg, rgba(42, 30, 0, 0.95), rgba(26, 18, 0, 0.95)),
                url('data:image/svg+xml;utf8,<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="modalPapyrus" patternUnits="userSpaceOnUse" width="200" height="200"><rect width="200" height="200" fill="%232a1e00"/><path d="M0,100 Q50,80 100,100 T200,100" stroke="%238b7355" stroke-width="1" fill="none" opacity="0.1"/></pattern></defs></svg>');
            border-radius: 12px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--color-primary);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 0 30px rgba(212, 175, 55, 0.1);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: var(--color-primary);
            color: #1a1200;
            transform: rotate(90deg);
        }

        .modal-title {
            font-size: 32px;
            color: var(--color-primary);
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 15px;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: rgba(58, 44, 0, 0.6);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--color-text-muted);
        }

        .result-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .result-label {
            font-size: 12px;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .strategy-analysis {
            background: rgba(58, 44, 0, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--color-success);
        }

        .analysis-title {
            color: var(--color-success);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .strategy-tip {
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid var(--color-primary);
        }

        .strategy-tip h4 {
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="header">
            <div class="game-title">
                <i class="fas fa-scroll" style="color: var(--color-primary); font-size: 32px;"></i>
                <h1>–î—Ä–µ–≤–Ω–∏–µ –ê–ª–≥–æ—Ä–∏—Ç–º—ã</h1>
            </div>
            
            <div class="era-display">
                <div class="era-name" id="eraName">–î–†–ï–í–ù–û–°–¢–¨</div>
                <div class="era-year" id="eraYears">3000-1000 –≥–≥. –¥–æ –Ω.—ç.</div>
            </div>
            
            <div class="year-display">
                <div class="year-number" id="yearNumber">3000</div>
                <div class="year-label">–î–û –ù–ê–®–ï–ô –≠–†–´</div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="main-area">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="left-panel">
                <div class="stats-section">
                    <div class="section-title">
                        <i class="fas fa-chess-king"></i>
                        <span>–¶–ê–†–°–¢–í–û –í–†–ï–ú–Å–ù</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="statGold">1500</div>
                            <div class="stat-label">–ó–û–õ–û–¢–´–• –ú–û–ù–ï–¢</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statTraders">1/1</div>
                            <div class="stat-label">–ö–ê–†–ê–í–ê–ù–©–ò–ö–ò</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statRoutes">0</div>
                            <div class="stat-label">–ê–ö–¢–ò–í–ù–´–• –ü–£–¢–ï–ô</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statCities">5/24</div>
                            <div class="stat-label">–û–¢–ö–†–´–¢–´–• –ì–û–†–û–î–û–í</div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="section-title">
                        <i class="fas fa-road"></i>
                        <span>–ú–ê–†–®–†–£–¢ –ö–ê–†–ê–í–ê–ù–ê</span>
                    </div>
                    <div id="routeInfo" style="color: var(--color-text-muted); font-size: 14px; padding: 15px; text-align: center;">
                        –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—Ü–∞ –¥–ª—è –ø—Ä–æ–∫–ª–∞–¥–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
                    </div>
                    <div id="selectedRoute" style="display: none;">
                        <div style="margin-bottom: 15px; padding: 10px; background: rgba(58, 44, 0, 0.6); border-radius: 6px;">
                            <div style="color: var(--color-primary); font-weight: bold; margin-bottom: 5px;" id="routeCities"></div>
                            <div style="color: var(--color-warning); font-size: 12px;" id="routeDistance"></div>
                        </div>
                        <button id="confirmRouteBtn" class="action-btn primary" style="width: 100%; padding: 12px;">
                            <i class="fas fa-check"></i>
                            <span>–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ú–ê–†–®–†–£–¢</span>
                        </button>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="section-title">
                        <i class="fas fa-history"></i>
                        <span>–õ–ï–¢–û–ü–ò–°–¨</span>
                    </div>
                    <div id="eventLog" style="height: 200px; overflow-y: auto; padding: 10px; background: rgba(58, 44, 0, 0.4); border-radius: 6px;">
                        <div style="color: var(--color-text-muted); font-size: 12px; text-align: center; padding: 20px;">
                            –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="map-section">
                <div class="map-container-wrapper" id="mapWrapper">
                    <div id="gameMap">
                        <!-- –ì–æ—Ä–æ–¥–∞ –∏ –ø—É—Ç–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
                
                <div class="map-controls">
                    <button class="map-control-btn" id="zoomInBtn">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="map-control-btn" id="zoomOutBtn">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="map-control-btn" id="centerMapBtn">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="footer">
            <div class="resource-display">
                <div class="resource-item">
                    <div class="resource-icon">üèõÔ∏è</div>
                    <div class="resource-info">
                        <div class="resource-value" id="goldValue">1500</div>
                        <div class="resource-label">–ö–ê–ó–ù–ê –¶–ê–†–°–¢–í–ê</div>
                    </div>
                </div>
                
                <div class="resource-item">
                    <div class="resource-icon">üê´</div>
                    <div class="resource-info">
                        <div class="resource-value" id="tradersValue">1</div>
                        <div class="resource-label">–°–í–û–ë–û–î–ù–´–ï –¢–û–†–ì–û–í–¶–´</div>
                    </div>
                </div>
                
                <div class="resource-item">
                    <div class="resource-icon">‚è≥</div>
                    <div class="resource-info">
                        <div class="resource-value" id="routeLength">3</div>
                        <div class="resource-label">–®–ê–ì–û–í –ú–ê–†–®–†–£–¢–ê</div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn primary" id="playPauseBtn">
                    <i class="fas fa-play"></i>
                    <span>–ù–ê–ß–ê–¢–¨ –≠–ü–û–•–£</span>
                </button>
                <button class="action-btn primary" id="autoRouteBtn" disabled>
                    <i class="fas fa-robot"></i>
                    <span>–ê–í–¢–û-–ú–ê–†–®–†–£–¢ (50üí∞)</span>
                </button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <button class="notification-close">&times;</button>
        <div class="notification-title" id="notificationTitle"></div>
        <div class="notification-message" id="notificationMessage"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <h2 class="modal-title" id="resultsTitle">–ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê!</h2>
            <div style="text-align: center; margin-bottom: 30px; font-size: 18px; color: var(--color-text);" id="resultsMessage"></div>
            
            <div class="results-grid">
                <div class="result-stat">
                    <div class="result-value" id="finalGold">0</div>
                    <div class="result-label">–§–ò–ù–ê–õ–¨–ù–ê–Ø –ö–ê–ó–ù–ê</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="finalRoutes">0</div>
                    <div class="result-label">–°–û–ó–î–ê–ù–û –ü–£–¢–ï–ô</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="finalTraders">0</div>
                    <div class="result-label">–¢–û–†–ì–û–í–¶–ï–í –ú–ê–ö–°</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="finalScore">0</div>
                    <div class="result-label">–û–¶–ï–ù–ö–ê –¶–ê–†–Ø</div>
                </div>
            </div>

            <div class="strategy-analysis">
                <h3 class="analysis-title"><i class="fas fa-chart-bar"></i> –ê–ù–ê–õ–ò–ó –°–¢–†–ê–¢–ï–ì–ò–ò</h3>
                <div id="strategyAnalysis"></div>
            </div>

            <button class="action-btn primary" style="margin-top: 30px; width: 100%;" onclick="location.reload()">
                <i class="fas fa-redo"></i>
                <span>–ù–ê–ß–ê–¢–¨ –ù–û–í–£–Æ –ò–ì–†–£</span>
            </button>
        </div>
    </div>

    <script>
        class HistoricalTradingGame {
            constructor() {
                // –ò–≥—Ä–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                this.gold = 1500; // –£–≤–µ–ª–∏—á–∏–ª —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –∑–æ–ª–æ—Ç–æ
                this.totalTraders = 1;
                this.availableTraders = 1;
                this.year = -3000;
                this.maxYears = 5020;
                this.gameOver = false;
                this.isPlaying = false;
                this.currentEra = 0;
                this.baseRouteLength = 3;
                
                // –≠–ø–æ—Ö–∏
                this.eras = [
                    { name: "–î–†–ï–í–ù–û–°–¢–¨", start: -3000, end: -1000, color: "#8b7355", icon: "üè∫" },
                    { name: "–ê–ù–¢–ò–ß–ù–û–°–¢–¨", start: -999, end: 476, color: "#d4af37", icon: "‚öîÔ∏è" },
                    { name: "–°–†–ï–î–ù–ï–í–ï–ö–û–í–¨–ï", start: 477, end: 1492, color: "#8b0000", icon: "üè∞" },
                    { name: "–ù–û–í–û–ï –í–†–ï–ú–Ø", start: 1493, end: 1914, color: "#b8860b", icon: "‚öì" },
                    { name: "–°–û–í–†–ï–ú–ï–ù–ù–û–°–¢–¨", start: 1915, end: 2020, color: "#cd853f", icon: "üöÄ" }
                ];
                
                // –ì–æ—Ä–æ–¥–∞ –∏ —Ç–æ—Ä–≥–æ–≤—Ü—ã
                this.cities = [];
                this.traders = [];
                this.routes = [];
                this.activeRoutes = 0;
                this.discoveredCities = new Set();
                
                // –ì–æ—Ä–æ–¥–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ –Ω—É–∂–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
                this.cityConnections = new Map(); // –ö–ª—é—á: cityId, –∑–Ω–∞—á–µ–Ω–∏–µ: –º–∞—Å—Å–∏–≤ cityId –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
                
                // –í—ã–±–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∞
                this.selectedTrader = null;
                this.routeInProgress = [];
                this.previewRoutes = [];
                
                // –°—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è (—É–º–µ–Ω—å—à–∏–ª)
                this.upkeepPerTrader = 2; // –ë—ã–ª–æ 5
                this.upkeepPerCity = 1;   // –ë—ã–ª–æ 2
                
                // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
                this.events = [];
                this.lastEventYear = -3000;
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π
                this.mapScale = 0.8;
                this.mapX = 0;
                this.mapY = 0;
                this.isDragging = false;
                this.dragStartX = 0;
                this.dragStartY = 0;
                this.mapStartX = 0;
                this.mapStartY = 0;
                
                // –†–µ—Å—É—Ä—Å—ã –ø–æ —ç–ø–æ—Ö–∞–º
                this.resourcesByEra = [
                    // –î—Ä–µ–≤–Ω–æ—Å—Ç—å
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 20, demand: 'wine' },
                        { id: 'wine', name: '–í–∏–Ω–æ', icon: 'üç∑', value: 30, demand: 'oil' },
                        { id: 'oil', name: '–ú–∞—Å–ª–æ', icon: 'ü´í', value: 25, demand: 'grain' },
                        { id: 'copper', name: '–ú–µ–¥—å', icon: 'üîß', value: 35, demand: 'wine' },
                        { id: 'salt', name: '–°–æ–ª—å', icon: 'üßÇ', value: 22, demand: 'grain' }
                    ],
                    // –ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 25, demand: 'wine' },
                        { id: 'wine', name: '–í–∏–Ω–æ', icon: 'üç∑', value: 35, demand: 'marble' },
                        { id: 'marble', name: '–ú—Ä–∞–º–æ—Ä', icon: 'üóø', value: 45, demand: 'oil' },
                        { id: 'metal', name: '–ë—Ä–æ–Ω–∑–∞', icon: 'üõ°Ô∏è', value: 40, demand: 'grain' },
                        { id: 'glass', name: '–°—Ç–µ–∫–ª–æ', icon: 'ü•É', value: 37, demand: 'wine' }
                    ],
                    // –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 30, demand: 'wine' },
                        { id: 'wine', name: '–í–∏–Ω–æ', icon: 'üç∑', value: 40, demand: 'spice' },
                        { id: 'spice', name: '–ü—Ä—è–Ω–æ—Å—Ç–∏', icon: 'üå∂Ô∏è', value: 50, demand: 'silk' },
                        { id: 'silk', name: '–®—ë–ª–∫', icon: 'üëò', value: 55, demand: 'metal' },
                        { id: 'metal', name: '–ñ–µ–ª–µ–∑–æ', icon: '‚öîÔ∏è', value: 45, demand: 'grain' },
                        { id: 'fur', name: '–ú–µ—Ö–∞', icon: 'üß•', value: 42, demand: 'salt' }
                    ],
                    // –ù–æ–≤–æ–µ –≤—Ä–µ–º—è
                    [
                        { id: 'grain', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', value: 35, demand: 'silk' },
                        { id: 'silk', name: '–®—ë–ª–∫', icon: 'üëò', value: 65, demand: 'spice' },
                        { id: 'spice', name: '–ü—Ä—è–Ω–æ—Å—Ç–∏', icon: 'üå∂Ô∏è', value: 75, demand: 'tea' },
                        { id: 'tea', name: '–ß–∞–π', icon: 'üçµ', value: 60, demand: 'coffee' },
                        { id: 'coffee', name: '–ö–æ—Ñ–µ', icon: '‚òï', value: 70, demand: 'sugar' },
                        { id: 'sugar', name: '–°–∞—Ö–∞—Ä', icon: 'üç¨', value: 55, demand: 'grain' },
                        { id: 'cotton', name: '–•–ª–æ–ø–æ–∫', icon: 'üëï', value: 50, demand: 'tea' }
                    ],
                    // –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å
                    [
                        { id: 'oil', name: '–ù–µ—Ñ—Ç—å', icon: 'üõ¢Ô∏è', value: 100, demand: 'tech' },
                        { id: 'tech', name: '–¢–µ—Ö–Ω–∏–∫–∞', icon: 'üíª', value: 150, demand: 'oil' },
                        { id: 'cars', name: '–ê–≤—Ç–æ', icon: 'üöó', value: 120, demand: 'oil' },
                        { id: 'medicine', name: '–õ–µ–∫–∞—Ä—Å—Ç–≤–∞', icon: 'üíä', value: 130, demand: 'tech' },
                        { id: 'food', name: '–ü—Ä–æ–¥—É–∫—Ç—ã', icon: 'üçî', value: 85, demand: 'tech' },
                        { id: 'electronics', name: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', icon: 'üì±', value: 145, demand: 'oil' }
                    ]
                ];
                
                // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –≥–æ—Ä–æ–¥–∞ (24 –≥–æ—Ä–æ–¥–∞, 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞ —Å—Ç–∞—Ä—Ç–µ)
                this.historicalCities = [
                    // –≠–ø–æ—Ö–∞ –î—Ä–µ–≤–Ω–æ—Å—Ç–∏ - 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
                    { name: "–£—Ä", era: 0, x: 400, y: 500, isActive: true, connections: [5, 6, 7, 8] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ê—Ñ–∏–Ω—ã, –†–∏–º, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—é, –ö–∞—Ä—Ñ–∞–≥–µ–Ω
                    { name: "–ú–µ–º—Ñ–∏—Å", era: 0, x: 600, y: 550, isActive: true, connections: [5, 9, 10] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ê—Ñ–∏–Ω—ã, –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å, –í–µ–Ω–µ—Ü–∏—é
                    { name: "–í–∞–≤–∏–ª–æ–Ω", era: 0, x: 700, y: 400, isActive: true, connections: [6, 7, 11] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –†–∏–º, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—é, –ë–∞–≥–¥–∞–¥
                    { name: "–ù–∏–Ω–µ–≤–∏—è", era: 0, x: 750, y: 450, isActive: true, connections: [8, 11, 12] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ö–∞—Ä—Ñ–∞–≥–µ–Ω, –ë–∞–≥–¥–∞–¥, –ü–∞—Ä–∏–∂
                    { name: "–°—É–∑—ã", era: 0, x: 800, y: 500, isActive: true, connections: [9, 10, 13] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å, –í–µ–Ω–µ—Ü–∏—é, –õ–æ–Ω–¥–æ–Ω
                    
                    // –≠–ø–æ—Ö–∞ –ê–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ - –±—É–¥—É—Ç –æ—Ç–∫—Ä—ã—Ç—ã
                    { name: "–ê—Ñ–∏–Ω—ã", era: 1, x: 350, y: 600, isActive: false, connections: [14, 15, 16] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ê–º—Å—Ç–µ—Ä–¥–∞–º, –ù—å—é-–ô–æ—Ä–∫, –¢–æ–∫–∏–æ
                    { name: "–†–∏–º", era: 1, x: 300, y: 550, isActive: false, connections: [14, 17, 18] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ê–º—Å—Ç–µ—Ä–¥–∞–º, –®–∞–Ω—Ö–∞–π, –ë–µ—Ä–ª–∏–Ω
                    { name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è", era: 1, x: 550, y: 600, isActive: false, connections: [15, 19, 20] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ù—å—é-–ô–æ—Ä–∫, –ú—É–º–±–∞–∏, –°—Ç–∞–º–±—É–ª
                    { name: "–ö–∞—Ä—Ñ–∞–≥–µ–Ω", era: 1, x: 250, y: 500, isActive: false, connections: [16, 21, 22] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¢–æ–∫–∏–æ, –ö–∞–∏—Ä, –î–∞–º–∞—Å–∫
                    
                    // –≠–ø–æ—Ö–∞ –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å—è
                    { name: "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å", era: 2, x: 450, y: 500, isActive: false, connections: [17, 19, 23] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –®–∞–Ω—Ö–∞–π, –ú—É–º–±–∞–∏, –ú–∞–¥—Ä–∏–¥
                    { name: "–í–µ–Ω–µ—Ü–∏—è", era: 2, x: 280, y: 450, isActive: false, connections: [18, 20, 21] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ë–µ—Ä–ª–∏–Ω, –°—Ç–∞–º–±—É–ª, –ö–∞–∏—Ä
                    { name: "–ë–∞–≥–¥–∞–¥", era: 2, x: 850, y: 450, isActive: false, connections: [22, 23] }, // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –î–∞–º–∞—Å–∫, –ú–∞–¥—Ä–∏–¥
                    
                    // –≠–ø–æ—Ö–∞ –ù–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    { name: "–ü–∞—Ä–∏–∂", era: 3, x: 200, y: 400, isActive: false, connections: [] },
                    { name: "–õ–æ–Ω–¥–æ–Ω", era: 3, x: 150, y: 350, isActive: false, connections: [] },
                    { name: "–ê–º—Å—Ç–µ—Ä–¥–∞–º", era: 3, x: 230, y: 380, isActive: false, connections: [] },
                    
                    // –≠–ø–æ—Ö–∞ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
                    { name: "–ù—å—é-–ô–æ—Ä–∫", era: 4, x: 100, y: 300, isActive: false, connections: [] },
                    { name: "–¢–æ–∫–∏–æ", era: 4, x: 1200, y: 400, isActive: false, connections: [] },
                    { name: "–®–∞–Ω—Ö–∞–π", era: 4, x: 1100, y: 450, isActive: false, connections: [] },
                    { name: "–ë–µ—Ä–ª–∏–Ω", era: 4, x: 350, y: 380, isActive: false, connections: [] },
                    { name: "–ú—É–º–±–∞–∏", era: 4, x: 950, y: 600, isActive: false, connections: [] },
                    { name: "–°—Ç–∞–º–±—É–ª", era: 4, x: 500, y: 450, isActive: false, connections: [] },
                    { name: "–ö–∞–∏—Ä", era: 4, x: 650, y: 550, isActive: false, connections: [] },
                    { name: "–î–∞–º–∞—Å–∫", era: 4, x: 750, y: 500, isActive: false, connections: [] },
                    { name: "–ú–∞–¥—Ä–∏–¥", era: 4, x: 150, y: 450, isActive: false, connections: [] }
                ];
                
                this.init();
            }

            init() {
                this.setupMapControls();
                this.createCities();
                this.createInitialTrader();
                this.setupEventListeners();
                this.updateUI();
                this.updateEra();
                this.centerMap();
                
                this.showNotification("üèõÔ∏è –î–†–ï–í–ù–û–°–¢–¨ –ù–ê–ß–ê–õ–ê–°–¨", "3000 –ª–µ—Ç –¥–æ –Ω.—ç. 5 –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã!");
                this.logEvent("3000 –≥. –¥–æ –Ω.—ç. - –ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ –î—Ä–µ–≤–Ω–æ—Å—Ç–∏");
                this.logEvent("–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞: –£—Ä, –ú–µ–º—Ñ–∏—Å, –í–∞–≤–∏–ª–æ–Ω, –ù–∏–Ω–µ–≤–∏—è, –°—É–∑—ã");
            }

            setupMapControls() {
                const mapWrapper = document.getElementById('mapWrapper');
                
                mapWrapper.addEventListener('mousedown', (e) => {
                    if (this.gameOver) return;
                    this.isDragging = true;
                    this.dragStartX = e.clientX;
                    this.dragStartY = e.clientY;
                    this.mapStartX = this.mapX;
                    this.mapStartY = this.mapY;
                    mapWrapper.style.cursor = 'grabbing';
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!this.isDragging || this.gameOver) return;
                    
                    const dx = e.clientX - this.dragStartX;
                    const dy = e.clientY - this.dragStartY;
                    
                    this.mapX = this.mapStartX + dx / this.mapScale;
                    this.mapY = this.mapStartY + dy / this.mapScale;
                    
                    this.updateMapTransform();
                });
                
                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                    mapWrapper.style.cursor = 'grab';
                });
                
                mapWrapper.addEventListener('wheel', (e) => {
                    if (this.gameOver) return;
                    e.preventDefault();
                    const zoomSpeed = 0.1;
                    const oldScale = this.mapScale;
                    
                    if (e.deltaY < 0) {
                        this.mapScale = Math.min(2, this.mapScale * (1 + zoomSpeed));
                    } else {
                        this.mapScale = Math.max(0.5, this.mapScale * (1 - zoomSpeed));
                    }
                    
                    const rect = mapWrapper.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;
                    const mouseY = e.clientY - rect.top;
                    
                    const scaleRatio = this.mapScale / oldScale;
                    this.mapX = mouseX - (mouseX - this.mapX) * scaleRatio;
                    this.mapY = mouseY - (mouseY - this.mapY) * scaleRatio;
                    
                    this.updateMapTransform();
                });
                
                document.getElementById('zoomInBtn').addEventListener('click', () => {
                    if (this.gameOver) return;
                    this.mapScale = Math.min(2, this.mapScale * 1.2);
                    this.updateMapTransform();
                });
                
                document.getElementById('zoomOutBtn').addEventListener('click', () => {
                    if (this.gameOver) return;
                    this.mapScale = Math.max(0.5, this.mapScale * 0.8);
                    this.updateMapTransform();
                });
                
                document.getElementById('centerMapBtn').addEventListener('click', () => {
                    if (this.gameOver) return;
                    this.centerMap();
                });
            }

            updateMapTransform() {
                const gameMap = document.getElementById('gameMap');
                gameMap.style.transform = `translate(${this.mapX}px, ${this.mapY}px) scale(${this.mapScale})`;
            }

            centerMap() {
                const wrapper = document.getElementById('mapWrapper');
                const map = document.getElementById('gameMap');
                
                this.mapScale = 0.8;
                this.mapX = (wrapper.clientWidth - map.clientWidth * this.mapScale) / 2;
                this.mapY = (wrapper.clientHeight - map.clientHeight * this.mapScale) / 2;
                
                this.updateMapTransform();
            }

            createCities() {
                const map = document.getElementById('gameMap');
                map.innerHTML = '';
                
                this.cities = [];
                this.historicalCities.forEach((cityData, index) => {
                    const eraResources = this.resourcesByEra[cityData.era];
                    const resource = eraResources[Math.floor(Math.random() * eraResources.length)];
                    
                    // –í—ã–±–∏—Ä–∞–µ–º —Ä–µ—Å—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–æ—Ä–æ–¥—É (–æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –æ–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç)
                    let demandResource;
                    do {
                        demandResource = eraResources[Math.floor(Math.random() * eraResources.length)];
                    } while (demandResource.id === resource.id);
                    
                    const city = {
                        id: index,
                        ...cityData,
                        resource: resource,
                        demand: demandResource,
                        isDiscovered: cityData.isActive,
                        visitedBy: new Set(),
                        tradersInCity: new Set(),
                        baseValue: resource.value,
                        currentValue: this.calculateCityValue(cityData, resource),
                        gaveTrader: false,
                        element: null,
                        routes: []
                    };
                    
                    this.cities.push(city);
                    
                    if (city.isDiscovered) {
                        this.discoveredCities.add(city.id);
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≥–æ—Ä–æ–¥–æ–≤
                    if (cityData.connections) {
                        this.cityConnections.set(city.id, cityData.connections);
                    }
                    
                    const cityEl = this.createCityElement(city);
                    city.element = cityEl;
                    map.appendChild(cityEl);
                });
            }

            calculateCityValue(cityData, resource) {
                let value = resource.value;
                
                // –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
                const randomFactor = 0.8 + Math.random() * 0.4;
                value *= randomFactor;
                
                // –ë–æ–Ω—É—Å –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
                const majorCities = ['–£—Ä', '–í–∞–≤–∏–ª–æ–Ω', '–ú–µ–º—Ñ–∏—Å', '–ê—Ñ–∏–Ω—ã', '–†–∏–º', '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª—å'];
                if (majorCities.includes(cityData.name)) {
                    value *= 1.3;
                }
                
                return Math.round(value);
            }

            createCityElement(city) {
                const el = document.createElement('div');
                el.className = `city ${city.isDiscovered ? 'active' : 'locked'}`;
                el.style.left = `${city.x}px`;
                el.style.top = `${city.y}px`;
                el.style.background = this.getCityGradient(city.resource.id);
                el.dataset.cityId = city.id;
                
                const cityContent = document.createElement('div');
                cityContent.style.position = 'relative';
                
                if (!city.isDiscovered) {
                    cityContent.innerHTML = `
                        <div class="city-icon">‚ùì</div>
                        <div class="city-name">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</div>
                    `;
                } else {
                    cityContent.innerHTML = `
                        <div class="city-icon">${city.resource.icon}</div>
                        <div class="city-name">${city.name}</div>
                        <div class="city-info">
                            <div class="city-demand">–¢—Ä–µ–±—É–µ—Ç: ${city.demand.icon}</div>
                            <div class="city-value">${city.currentValue}üí∞</div>
                        </div>
                    `;
                }
                
                el.appendChild(cityContent);
                
                if (city.isDiscovered) {
                    el.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.selectCityForRoute(city);
                    });
                }
                
                return el;
            }

            updateCityTradersDisplay(city) {
                if (!city.element) return;
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å—á–µ—Ç—á–∏–∫
                const oldCounter = city.element.querySelector('.city-traders');
                if (oldCounter) {
                    oldCounter.remove();
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤—Ü—ã
                if (city.tradersInCity.size > 0) {
                    const counter = document.createElement('div');
                    counter.className = 'city-traders';
                    counter.textContent = city.tradersInCity.size;
                    city.element.querySelector('div').appendChild(counter);
                }
            }

            getCityGradient(resourceId) {
                const gradients = {
                    'grain': 'linear-gradient(135deg, #d4af37, #b8860b)',
                    'wine': 'linear-gradient(135deg, #8b0000, #660000)',
                    'oil': 'linear-gradient(135deg, #808000, #556b2f)',
                    'copper': 'linear-gradient(135deg, #cd7f32, #b87333)',
                    'salt': 'linear-gradient(135deg, #f5f5f5, #dcdcdc)',
                    'marble': 'linear-gradient(135deg, #f5f5f5, #d3d3d3)',
                    'metal': 'linear-gradient(135deg, #a9a9a9, #696969)',
                    'glass': 'linear-gradient(135deg, #87ceeb, #4682b4)',
                    'silk': 'linear-gradient(135deg, #da70d6, #ba55d3)',
                    'spice': 'linear-gradient(135deg, #ff4500, #dc143c)',
                    'fur': 'linear-gradient(135deg, #8b4513, #654321)',
                    'tea': 'linear-gradient(135deg, #8b7355, #6b5c43)',
                    'coffee': 'linear-gradient(135deg, #8b4513, #654321)',
                    'sugar': 'linear-gradient(135deg, #ffe4e1, #ffb6c1)',
                    'cotton': 'linear-gradient(135deg, #f0f8ff, #e6e6fa)',
                    'tech': 'linear-gradient(135deg, #00bfff, #1e90ff)',
                    'cars': 'linear-gradient(135deg, #ff4500, #ff6347)',
                    'medicine': 'linear-gradient(135deg, #32cd32, #228b22)',
                    'food': 'linear-gradient(135deg, #ffd700, #daa520)',
                    'electronics': 'linear-gradient(135deg, #9370db, #8a2be2)'
                };
                return gradients[resourceId] || 'linear-gradient(135deg, #8b7355, #6b5c43)';
            }

            createInitialTrader() {
                const initialCity = this.cities.find(c => c.name === "–£—Ä");
                if (!initialCity) return;
                
                const trader = {
                    id: 0,
                    name: "–°–∏–Ω-–ê—Ö—Ö–µ-–†–∏–±–∞",
                    cityId: initialCity.id,
                    route: [],
                    currentPosition: 0,
                    isMoving: false,
                    isTraveling: false,
                    cargo: null,
                    goldEarned: 0,
                    element: null,
                    isIdle: true,
                    currentTargetCityId: null
                };
                
                this.traders.push(trader);
                initialCity.tradersInCity.add(trader.id);
                this.createTraderElement(trader);
                this.updateCityTradersDisplay(initialCity);
            }

            createTraderElement(trader) {
                const city = this.cities.find(c => c.id === trader.cityId);
                if (!city) return;
                
                const map = document.getElementById('gameMap');
                const merchant = document.createElement('div');
                merchant.className = `merchant ${trader.isIdle ? 'idle' : ''}`;
                merchant.style.left = `${city.x}px`;
                merchant.style.top = `${city.y}px`;
                merchant.dataset.traderId = trader.id;
                merchant.innerHTML = 'üê´';
                
                merchant.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectTrader(trader);
                });
                
                trader.element = merchant;
                map.appendChild(merchant);
            }

            selectTrader(trader) {
                if (this.isPlaying || !trader.isIdle) return;
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤—ã–±–æ—Ä
                if (this.selectedTrader) {
                    this.selectedTrader.element.classList.remove('selected');
                    this.clearRoutePreview();
                }
                
                this.selectedTrader = trader;
                trader.element.classList.add('selected');
                
                document.getElementById('routeInfo').innerHTML = `
                    <div style="color: var(--color-primary); margin-bottom: 10px;">
                        <strong>${trader.name}</strong> –≥–æ—Ç–æ–≤ –∫ –º–∞—Ä—à—Ä—É—Ç—É
                    </div>
                    <div style="font-size: 12px; color: var(--color-text-muted);">
                        –í—ã–±–µ—Ä–∏—Ç–µ ${this.baseRouteLength} –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è<br>
                        –ü–µ—Ä–≤—ã–π –≥–æ—Ä–æ–¥: ${this.cities.find(c => c.id === trader.cityId).name}
                    </div>
                `;
                
                this.showPossibleRoutes(trader);
            }

            showPossibleRoutes(trader) {
                this.clearRoutePreview();
                
                const startCity = this.cities.find(c => c.id === trader.cityId);
                const availableCities = this.cities.filter(c => 
                    c.isDiscovered && 
                    c.id !== startCity.id
                );
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
                availableCities.forEach(city => {
                    city.element.style.border = '2px dashed var(--color-primary)';
                    city.element.style.transform = 'translate(-50%, -50%) scale(1.1)';
                });
            }

            selectCityForRoute(city) {
                if (!this.selectedTrader || this.isPlaying) return;
                if (!city.isDiscovered) return;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥
                if (this.routeInProgress.includes(city)) {
                    // –£–¥–∞–ª—è–µ–º –≥–æ—Ä–æ–¥ –∏–∑ –º–∞—Ä—à—Ä—É—Ç–∞
                    const index = this.routeInProgress.indexOf(city);
                    this.routeInProgress.splice(index, 1);
                    city.element.style.border = '2px dashed var(--color-primary)';
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
                    if (this.routeInProgress.length >= this.baseRouteLength) {
                        this.showNotification("‚ùå –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ø—Ä–µ–¥–µ–ª", `–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å ${this.baseRouteLength} –≥–æ—Ä–æ–¥–æ–≤`);
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≥–æ—Ä–æ–¥ –Ω–µ —Å–æ—Å–µ–¥–Ω–∏–π —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º
                    if (this.routeInProgress.length > 0) {
                        const lastCity = this.routeInProgress[this.routeInProgress.length - 1];
                        const distance = this.calculateDistance(lastCity, city);
                        if (distance > 400) {
                            this.showNotification("‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ", "–¢–æ—Ä–≥–æ–≤–µ—Ü –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏ —Ç–∞–∫–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –∑–∞ –æ–¥–∏–Ω —à–∞–≥");
                            return;
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥
                    const startCity = this.cities.find(c => c.id === this.selectedTrader.cityId);
                    if (city.id === startCity.id) {
                        this.showNotification("‚ö†Ô∏è –ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥", "–ú–∞—Ä—à—Ä—É—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞");
                        return;
                    }
                    
                    this.routeInProgress.push(city);
                    city.element.style.border = '3px solid var(--color-success)';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
                this.updateRoutePreview();
                
                // –ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à—ë–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                if (this.routeInProgress.length === this.baseRouteLength) {
                    document.getElementById('selectedRoute').style.display = 'block';
                    
                    const routeText = this.routeInProgress.map(c => c.name).join(' ‚Üí ');
                    document.getElementById('routeCities').textContent = routeText;
                    
                    let totalDistance = 0;
                    for (let i = 0; i < this.routeInProgress.length - 1; i++) {
                        totalDistance += this.calculateDistance(this.routeInProgress[i], this.routeInProgress[i + 1]);
                    }
                    document.getElementById('routeDistance').textContent = 
                        `–û–±—â–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è: ${Math.round(totalDistance)} —à–∞–≥–æ–≤`;
                } else {
                    document.getElementById('selectedRoute').style.display = 'none';
                }
            }

            updateRoutePreview() {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ preview
                document.querySelectorAll('.trade-route.preview').forEach(el => el.remove());
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ preview
                const startCity = this.cities.find(c => c.id === this.selectedTrader.cityId);
                let previousCity = startCity;
                
                for (let i = 0; i < this.routeInProgress.length; i++) {
                    const currentCity = this.routeInProgress[i];
                    this.createRouteElement(previousCity, currentCity, true);
                    previousCity = currentCity;
                }
                
                // –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—Ä–µ–∑–æ–∫ –Ω–∞–∑–∞–¥ –≤ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥
                if (this.routeInProgress.length === this.baseRouteLength) {
                    this.createRouteElement(previousCity, startCity, true);
                }
            }

            clearRoutePreview() {
                document.querySelectorAll('.trade-route.preview').forEach(el => el.remove());
                this.cities.forEach(city => {
                    if (city.element) {
                        city.element.style.border = '';
                        city.element.style.transform = '';
                    }
                });
                this.routeInProgress = [];
                document.getElementById('selectedRoute').style.display = 'none';
            }

            createRouteElement(cityA, cityB, isPreview = false) {
                const map = document.getElementById('gameMap');
                
                const path = document.createElement('div');
                path.className = `trade-route ${isPreview ? 'preview' : 'active'}`;
                
                const dx = cityB.x - cityA.x;
                const dy = cityB.y - cityA.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                path.style.width = `${length}px`;
                path.style.left = `${cityA.x}px`;
                path.style.top = `${cityA.y}px`;
                path.style.transform = `rotate(${angle}deg)`;
                
                if (!isPreview) {
                    path.dataset.routeId = `${cityA.id}-${cityB.id}`;
                }
                
                map.appendChild(path);
                return path;
            }

            calculateDistance(cityA, cityB) {
                const dx = cityA.x - cityB.x;
                const dy = cityA.y - cityB.y;
                return Math.sqrt(dx * dx + dy * dy);
            }

            confirmRoute() {
                if (!this.selectedTrader || this.routeInProgress.length !== this.baseRouteLength) {
                    this.showNotification("‚ùå –ú–∞—Ä—à—Ä—É—Ç –Ω–µ –≥–æ—Ç–æ–≤", "–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä–æ–¥–æ–≤");
                    return;
                }

                // –°–æ–∑–¥–∞–µ–º –º–∞—Ä—à—Ä—É—Ç (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π: —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥ ‚Üí –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ ‚Üí —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥)
                const startCity = this.cities.find(c => c.id === this.selectedTrader.cityId);
                const route = {
                    traderId: this.selectedTrader.id,
                    cities: [startCity, ...this.routeInProgress, startCity], // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç
                    currentStep: 0,
                    isActive: true
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—Ä–≥–æ–≤—Ü–∞
                this.selectedTrader.route = route.cities.map(c => c.id);
                this.selectedTrader.currentPosition = 0;
                this.selectedTrader.isIdle = false;
                this.selectedTrader.isMoving = true;
                this.selectedTrader.element.classList.remove('idle', 'selected');
                
                // –£–±–∏—Ä–∞–µ–º —Ç–æ—Ä–≥–æ–≤—Ü–∞ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ—Ä–æ–¥–∞
                startCity.tradersInCity.delete(this.selectedTrader.id);
                this.updateCityTradersDisplay(startCity);
                
                // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏
                for (let i = 0; i < route.cities.length - 1; i++) {
                    this.createRouteElement(route.cities[i], route.cities[i + 1]);
                }
                
                this.routes.push(route);
                this.activeRoutes++;
                this.availableTraders--;
                
                const routeNames = route.cities.slice(1, -1).map(c => c.name).join(' ‚Üí ');
                this.logEvent(`${this.getYearText()} - ${this.selectedTrader.name} –Ω–∞—á–∞–ª –º–∞—Ä—à—Ä—É—Ç: ${startCity.name} ‚Üí ${routeNames} ‚Üí ${startCity.name}`);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                this.clearRoutePreview();
                this.selectedTrader = null;
                
                this.updateUI();
                
                this.showNotification("‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω", "–¢–æ—Ä–≥–æ–≤–µ—Ü –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ù–∞—á–Ω–∏—Ç–µ —ç–ø–æ—Ö—É!");
            }

            playPause() {
                if (this.gameOver) return;
                
                if (!this.isPlaying) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
                    if (this.activeRoutes === 0) {
                        this.showNotification("‚ö†Ô∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤", "–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç");
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–≤–∞—Ç–∏—Ç –ª–∏ –¥–µ–Ω–µ–≥ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
                    const upkeep = this.calculateUpkeep();
                    if (this.gold < upkeep) {
                        this.showNotification("üíÄ –ë–ê–ù–ö–†–û–¢–°–¢–í–û!", "–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤");
                        this.endGame('bankruptcy');
                        return;
                    }
                    
                    this.isPlaying = true;
                    document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i><span>–ü–ê–£–ó–ê</span>';
                    this.gameLoop = setInterval(() => this.processYear(), 1500); // –ó–∞–º–µ–¥–ª–∏–ª —Ç–µ–º–ø
                    
                    this.showNotification("‚ñ∂Ô∏è –≠–ü–û–•–ê –ù–ê–ß–ê–õ–ê–°–¨", "–í—Ä–µ–º—è –∏–¥—ë—Ç, —Ç–æ—Ä–≥–æ–≤—Ü—ã –≤ –ø—É—Ç–∏...");
                } else {
                    this.isPlaying = false;
                    clearInterval(this.gameLoop);
                    document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i><span>–ü–†–û–î–û–õ–ñ–ò–¢–¨</span>';
                    
                    this.showNotification("‚è∏Ô∏è –≠–ü–û–•–ê –ù–ê –ü–ê–£–ó–ï", "–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤");
                }
            }

            processYear() {
                if (this.gameOver) return;
                
                this.year++;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏
                if (this.year >= 2020) {
                    this.endGame('time');
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ø–æ—Ö—É
                this.updateEra();
                
                // –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ –∏ –≥–æ—Ä–æ–¥–æ–≤ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –∏–¥–µ—Ç)
                if (this.isPlaying) {
                    const upkeep = this.calculateUpkeep();
                    this.gold -= upkeep;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞
                    if (this.gold <= 0) {
                        this.gold = 0;
                        this.endGame('bankruptcy');
                        return;
                    }
                    
                    // –î–≤–∏–≥–∞–µ–º —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤
                    this.moveTraders();
                    
                    // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                    if (Math.random() < 0.05 && this.year - this.lastEventYear > 100) { // –†–µ–∂–µ —Å–æ–±—ã—Ç–∏—è
                        this.generateEvent();
                    }
                }
                
                this.updateUI();
            }

            calculateUpkeep() {
                const tradersCost = this.traders.length * this.upkeepPerTrader;
                const citiesCost = this.discoveredCities.size * this.upkeepPerCity;
                return tradersCost + citiesCost;
            }

            moveTraders() {
                this.routes.forEach(route => {
                    if (!route.isActive) return;
                    
                    const trader = this.traders.find(t => t.id === route.traderId);
                    if (!trader || !trader.isMoving) return;
                    
                    // –ï—Å–ª–∏ —Ç–æ—Ä–≥–æ–≤–µ—Ü —É–∂–µ –≤ –ø—É—Ç–∏ –º–µ–∂–¥—É –≥–æ—Ä–æ–¥–∞–º–∏
                    if (trader.isTraveling) {
                        return; // –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞
                    }
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≥–æ—Ä–æ–¥
                    const nextPosition = (trader.currentPosition + 1) % route.cities.length;
                    const currentCity = route.cities[trader.currentPosition];
                    const nextCity = route.cities[nextPosition];
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≥–æ—Ä–æ–¥—É
                    trader.isTraveling = true;
                    trader.currentTargetCityId = nextCity.id;
                    
                    // –£–±–∏—Ä–∞–µ–º –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ—Ä–æ–¥–∞
                    currentCity.tradersInCity.delete(trader.id);
                    this.updateCityTradersDisplay(currentCity);
                    
                    // –î–≤–∏–≥–∞–µ–º —Ç–æ—Ä–≥–æ–≤—Ü–∞ (–∑–∞–º–µ–¥–ª–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è)
                    this.moveTraderToCity(trader, nextCity);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏–±—ã—Ç–∏—è (2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏)
                    setTimeout(() => {
                        if (!this.isPlaying) return;
                        
                        trader.isTraveling = false;
                        trader.currentPosition = nextPosition;
                        trader.cityId = nextCity.id;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥
                        nextCity.tradersInCity.add(trader.id);
                        this.updateCityTradersDisplay(nextCity);
                        
                        // –ü—Ä–∏–±—ã—Ç–∏–µ –≤ –≥–æ—Ä–æ–¥
                        this.arriveAtCity(trader, currentCity, nextCity);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ª–∏ –º–∞—Ä—à—Ä—É—Ç (–≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥)
                        if (nextPosition === 0) {
                            this.completeRoute(trader, route);
                        }
                    }, 2000);
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ-–º–∞—Ä—à—Ä—É—Ç–∞
                document.getElementById('autoRouteBtn').disabled = this.gold < 50 || this.availableTraders === 0;
            }

            moveTraderToCity(trader, city) {
                if (!trader.element) return;
                
                trader.element.style.transition = 'left 2s linear, top 2s linear';
                trader.element.style.left = `${city.x}px`;
                trader.element.style.top = `${city.y}px`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–æ—Ä–æ–¥, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ—Ä–≥–æ–≤—Ü–∞
                city.element.classList.add('has-trader');
            }

            arriveAtCity(trader, fromCity, toCity) {
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≥–æ—Ä–æ–¥–∞
                fromCity.element.classList.remove('has-trader');
                
                // –ï—Å–ª–∏ —Ç–æ—Ä–≥–æ–≤–µ—Ü —á—Ç–æ-—Ç–æ –≤–µ–∑–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —ç—Ç–æ –≥–æ—Ä–æ–¥—É
                if (trader.cargo && trader.cargo.id === toCity.demand.id) {
                    // –£—Å–ø–µ—à–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞!
                    const profit = Math.round(toCity.currentValue * 1.5);
                    this.gold += profit;
                    trader.goldEarned += profit;
                    
                    this.logEvent(`${this.getYearText()} - ${trader.name} –¥–æ—Å—Ç–∞–≤–∏–ª ${trader.cargo.name} –≤ ${toCity.name} (+${profit}üí∞)`);
                    
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                    this.openConnectedCities(toCity);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–≤—ã–π –ª–∏ —Ä–∞–∑ —Ç–æ—Ä–≥–æ–≤–µ—Ü –ø–æ—Å–µ—â–∞–µ—Ç —ç—Ç–æ—Ç –≥–æ—Ä–æ–¥
                if (!toCity.visitedBy.has(trader.id)) {
                    toCity.visitedBy.add(trader.id);
                    
                    // –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –≤–ø–µ—Ä–≤—ã–µ –ø–æ—Å–µ—â–µ–Ω –≤–æ–æ–±—â–µ (–æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–∫—Ä—ã—Ç)
                    if (!this.discoveredCities.has(toCity.id)) {
                        this.discoverCity(toCity);
                    }
                    
                    // –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –µ—â–µ –Ω–µ –¥–∞–≤–∞–ª —Ç–æ—Ä–≥–æ–≤—Ü–∞ (–∏ —ç—Ç–æ –Ω–µ –Ω–∞—á–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ —Ç–æ—Ä–≥–æ–≤—Ü–∞)
                    if (!toCity.gaveTrader) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞ –≤ –≠–¢–û–¢ –ñ–ï –ì–û–†–û–î
                        this.addNewTrader(toCity);
                        toCity.gaveTrader = true;
                        
                        this.showNotification("üéâ –ù–û–í–´–ô –ö–ê–†–ê–í–ê–ù–©–ò–ö!", `${toCity.name} –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞`);
                    }
                }
                
                // –ë–µ—Ä–µ–º –Ω–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å –∏–∑ –≥–æ—Ä–æ–¥–∞
                trader.cargo = toCity.resource;
            }

            discoverCity(city) {
                city.isDiscovered = true;
                this.discoveredCities.add(city.id);
                city.element.classList.remove('locked');
                city.element.classList.add('active');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
                city.element.querySelector('.city-icon').textContent = city.resource.icon;
                city.element.querySelector('.city-name').textContent = city.name;
                city.element.querySelector('.city-demand').innerHTML = `–¢—Ä–µ–±—É–µ—Ç: ${city.demand.icon}`;
                city.element.querySelector('.city-value').textContent = `${city.currentValue}üí∞`;
                
                // –î–µ–ª–∞–µ–º –≥–æ—Ä–æ–¥ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º
                city.element.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectCityForRoute(city);
                });
                
                this.showNotification("üó∫Ô∏è –ù–û–í–´–ô –ì–û–†–û–î –û–¢–ö–†–´–¢!", `${city.name} —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏`);
                this.logEvent(`${this.getYearText()} - –û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥: ${city.name}`);
            }

            openConnectedCities(city) {
                const connectedCityIds = this.cityConnections.get(city.id);
                if (!connectedCityIds) return;
                
                let openedCount = 0;
                connectedCityIds.forEach(cityId => {
                    const connectedCity = this.cities[cityId];
                    if (connectedCity && !connectedCity.isDiscovered) {
                        this.discoverCity(connectedCity);
                        openedCount++;
                    }
                });
                
                if (openedCount > 0) {
                    this.showNotification("üåç –û–¢–ö–†–´–¢–´ –ù–û–í–´–ï –ì–û–†–û–î–ê!", `–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${city.name} –æ—Ç–∫—Ä—ã–ª–∞ ${openedCount} –Ω–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤`);
                }
            }

            completeRoute(trader, route) {
                // –¢–æ—Ä–≥–æ–≤–µ—Ü –∑–∞–≤–µ—Ä—à–∏–ª –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
                trader.isIdle = true;
                trader.isMoving = false;
                trader.isTraveling = false;
                trader.element.classList.add('idle');
                this.availableTraders++;
                route.isActive = false;
                this.activeRoutes--;
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è –≤—Å–µ—Ö
                this.baseRouteLength++;
                document.getElementById('routeLength').textContent = this.baseRouteLength;
                
                this.showNotification("üìà –ú–ê–†–®–†–£–¢–´ –£–î–õ–ò–ù–ï–ù–´", `–¢–µ–ø–µ—Ä—å –º–∞—Ä—à—Ä—É—Ç—ã –º–æ–≥—É—Ç –≤–∫–ª—é—á–∞—Ç—å ${this.baseRouteLength} –≥–æ—Ä–æ–¥–æ–≤`);
                this.logEvent(`${this.getYearText()} - ${trader.name} –∑–∞–≤–µ—Ä—à–∏–ª –º–∞—Ä—à—Ä—É—Ç. –¢–µ–ø–µ—Ä—å –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª–∏–Ω–Ω–µ–µ!`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å—Ç–∞—Ä—Ç–∞/–ø–∞—É–∑—ã –µ—Å–ª–∏ –≤—Å–µ —Ç–æ—Ä–≥–æ–≤—Ü—ã —Å–≤–æ–±–æ–¥–Ω—ã
                if (this.availableTraders === this.totalTraders) {
                    document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i><span>–ü–†–û–î–û–õ–ñ–ò–¢–¨</span>';
                    this.isPlaying = false;
                    clearInterval(this.gameLoop);
                }
            }

            addNewTrader(city) {
                const newTraderId = this.traders.length;
                const trader = {
                    id: newTraderId,
                    name: this.getTraderName(newTraderId),
                    cityId: city.id,
                    route: [],
                    currentPosition: 0,
                    isMoving: false,
                    isTraveling: false,
                    cargo: null,
                    goldEarned: 0,
                    element: null,
                    isIdle: true,
                    currentTargetCityId: null
                };
                
                this.traders.push(trader);
                this.totalTraders++;
                this.availableTraders++;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—Ä–≥–æ–≤—Ü–∞ –≤ –≥–æ—Ä–æ–¥
                city.tradersInCity.add(trader.id);
                this.updateCityTradersDisplay(city);
                
                this.createTraderElement(trader);
                
                this.logEvent(`${this.getYearText()} - –ù–æ–≤—ã–π –∫–∞—Ä–∞–≤–∞–Ω—â–∏–∫ ${trader.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –≤ ${city.name}`);
            }

            getTraderName(id) {
                const names = [
                    "–•–∞–º–º—É—Ä–∞–ø–∏", "–°–∞—Ä–≥–æ–Ω", "–†–∞–º—Å–µ—Å", "–¢—É—Ç–º–æ—Å", "–ö–∏—Ä", "–î–∞—Ä–∏–π",
                    "–ü–µ—Ä–∏–∫–ª", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", "–¶–µ–∑–∞—Ä—å", "–ê–≤–≥—É—Å—Ç", "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω", "–Æ—Å—Ç–∏–Ω–∏–∞–Ω",
                    "–ö–∞—Ä–ª –í–µ–ª–∏–∫–∏–π", "–†–∏—á–∞—Ä–¥", "–§—Ä–∏–¥—Ä–∏—Ö", "–ì–µ–Ω—Ä–∏—Ö", "–§–µ—Ä–¥–∏–Ω–∞–Ω–¥", "–ò–∑–∞–±–µ–ª–ª–∞",
                    "–ö–æ–ª—É–º–±", "–ú–∞–≥–µ–ª–ª–∞–Ω", "–í–∞—Å–∫–æ –¥–∞ –ì–∞–º–∞", "–ö–æ—Ä—Ç–µ—Å", "–ù–∞–ø–æ–ª–µ–æ–Ω", "–í–µ–ª–ª–∏–Ω–≥—Ç–æ–Ω",
                    "–†–æ–∫—Ñ–µ–ª–ª–µ—Ä", "–ö–∞—Ä–Ω–µ–≥–∏", "–§–æ—Ä–¥", "–≠–¥–∏—Å–æ–Ω", "–¢–µ—Å–ª–∞", "–ì–µ–π—Ç—Å", "–î–∂–æ–±—Å"
                ];
                return names[id] || `–¢–æ—Ä–≥–æ–≤–µ—Ü ${id + 1}`;
            }

            updateEra() {
                const newEra = this.eras.findIndex(era => this.year >= era.start && this.year <= era.end);
                if (newEra !== -1 && newEra !== this.currentEra) {
                    this.currentEra = newEra;
                    const era = this.eras[this.currentEra];
                    
                    document.getElementById('eraName').textContent = era.name;
                    document.getElementById('eraYears').textContent = 
                        `${Math.abs(era.start)} ${era.start < 0 ? '–≥–≥. –¥–æ –Ω.—ç.' : '–≥–≥.'} - ${era.end} –≥–≥.`;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –Ω–æ–≤–æ–π —ç–ø–æ—Ö–∏
                    this.updateCityResources();
                    
                    this.showNotification(`${era.icon} –ù–û–í–ê–Ø –≠–ü–û–•–ê: ${era.name}`, 
                        `–ù–∞—Å—Ç—É–ø–∏–ª–∞ –Ω–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —ç–ø–æ—Ö–∞. –¢–æ—Ä–≥–æ–≤–ª—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å!`);
                    this.logEvent(`${this.getYearText()} - –ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ ${era.name}`);
                }
            }

            updateCityResources() {
                this.cities.forEach(city => {
                    if (city.era <= this.currentEra && city.isDiscovered) {
                        const eraResources = this.resourcesByEra[city.era];
                        const resource = eraResources[Math.floor(Math.random() * eraResources.length)];
                        
                        // –í—ã–±–∏—Ä–∞–µ–º —Ä–µ—Å—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–æ—Ä–æ–¥—É
                        let demandResource;
                        do {
                            demandResource = eraResources[Math.floor(Math.random() * eraResources.length)];
                        } while (demandResource.id === resource.id);
                        
                        city.resource = resource;
                        city.demand = demandResource;
                        city.baseValue = resource.value;
                        city.currentValue = this.calculateCityValue(city, resource);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        if (city.element) {
                            city.element.querySelector('.city-icon').textContent = resource.icon;
                            city.element.querySelector('.city-demand').innerHTML = 
                                `–¢—Ä–µ–±—É–µ—Ç: ${demandResource.icon}`;
                            city.element.querySelector('.city-value').textContent = `${city.currentValue}üí∞`;
                            city.element.style.background = this.getCityGradient(resource.id);
                        }
                    }
                });
            }

            generateEvent() {
                const events = [
                    {
                        title: "‚öîÔ∏è –í–û–ô–ù–ê!",
                        message: "–í–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–µ—Ä–µ–∫—Ä—ã–ª —Ç–æ—Ä–≥–æ–≤—ã–µ –ø—É—Ç–∏. –î–æ—Ö–æ–¥ —Å–Ω–∏–∂–µ–Ω –Ω–∞ 20%.",
                        effect: () => {
                            this.cities.forEach(city => {
                                city.currentValue = Math.round(city.currentValue * 0.8);
                            });
                        }
                    },
                    {
                        title: "üåæ –£–†–û–ñ–ê–ô!",
                        message: "–ù–µ–±—ã–≤–∞–ª—ã–π —É—Ä–æ–∂–∞–π –ø—à–µ–Ω–∏—Ü—ã. –¶–µ–Ω—ã –Ω–∞ –∑–µ—Ä–Ω–æ –≤—ã—Ä–æ—Å–ª–∏!",
                        effect: () => {
                            this.cities.forEach(city => {
                                if (city.resource.id === 'grain') {
                                    city.currentValue = Math.round(city.currentValue * 1.5);
                                }
                            });
                        }
                    },
                    {
                        title: "üõ≥Ô∏è –û–¢–ö–†–´–¢–ò–ï!",
                        message: "–û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π –ø—É—Ç—å. –í—Å–µ –≥–æ—Ä–æ–¥–∞ —Å—Ç–∞–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–µ–µ.",
                        effect: () => {
                            this.baseRouteLength++;
                            document.getElementById('routeLength').textContent = this.baseRouteLength;
                        }
                    },
                    {
                        title: "üíÄ –ß–£–ú–ê!",
                        message: "–≠–ø–∏–¥–µ–º–∏—è –æ–ø—É—Å—Ç–æ—à–∏–ª–∞ –≥–æ—Ä–æ–¥–∞. –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É–¥–≤–æ–µ–Ω–æ –Ω–∞ 10 –ª–µ—Ç.",
                        effect: () => {
                            this.upkeepPerCity *= 2;
                            setTimeout(() => {
                                this.upkeepPerCity /= 2;
                            }, 10000);
                        }
                    },
                    {
                        title: "üèõÔ∏è –†–ï–ù–ï–°–°–ê–ù–°!",
                        message: "–ö—É–ª—å—Ç—É—Ä–Ω—ã–π —Ä–∞—Å—Ü–≤–µ—Ç –ø—Ä–∏–≤–ª—ë–∫ –Ω–æ–≤—ã—Ö —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤.",
                        effect: () => {
                            const idleTraders = this.traders.filter(t => t.isIdle);
                            if (idleTraders.length < 3) {
                                this.availableTraders++;
                                this.totalTraders++;
                            }
                        }
                    }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                this.showNotification(event.title, event.message);
                event.effect();
                
                this.lastEventYear = this.year;
                this.logEvent(`${this.getYearText()} - ${event.message}`);
            }

            autoRoute() {
                if (this.gold < 50 || this.availableTraders === 0) return;
                
                this.gold -= 50;
                
                // –ù–∞—Ö–æ–¥–∏–º —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞
                const idleTrader = this.traders.find(t => t.isIdle);
                if (!idleTrader) return;
                
                this.selectTrader(idleTrader);
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
                const startCity = this.cities.find(c => c.id === idleTrader.cityId);
                const availableCities = this.cities.filter(c => 
                    c.isDiscovered && 
                    c.id !== startCity.id &&
                    this.calculateDistance(startCity, c) <= 400
                );
                
                // –í—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–µ –≤—ã–≥–æ–¥–Ω—ã–µ –≥–æ—Ä–æ–¥–∞, —É—á–∏—Ç—ã–≤–∞—è —Å–ø—Ä–æ—Å
                const bestCities = [...availableCities]
                    .sort((a, b) => {
                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≥–æ—Ä–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–µ–Ω —Ä–µ—Å—É—Ä—Å —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞
                        const startCityResource = startCity.resource.id;
                        const aScore = (a.demand.id === startCityResource ? 100 : 0) + a.currentValue;
                        const bScore = (b.demand.id === startCityResource ? 100 : 0) + b.currentValue;
                        return bScore - aScore;
                    })
                    .slice(0, this.baseRouteLength);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç
                this.clearRoutePreview();
                this.routeInProgress = bestCities;
                
                // –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Ä—à—Ä—É—Ç
                bestCities.forEach(city => {
                    city.element.style.border = '3px solid var(--color-success)';
                });
                this.updateRoutePreview();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
                setTimeout(() => {
                    if (this.routeInProgress.length === this.baseRouteLength) {
                        this.confirmRoute();
                        this.showNotification("ü§ñ –ú–ê–†–®–†–£–¢ –°–û–ó–î–ê–ù", "–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–∏–ª –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∑–∞ 50üí∞");
                    }
                }, 500);
            }

            endGame(reason) {
                this.gameOver = true;
                this.isPlaying = false;
                clearInterval(this.gameLoop);
                
                const finalScore = this.gold + (this.totalTraders * 100) + (this.discoveredCities.size * 50);
                let title = '';
                let message = '';
                
                if (reason === 'bankruptcy') {
                    title = 'üíÄ –ë–ê–ù–ö–†–û–¢–°–¢–í–û!';
                    message = '–í–∞—à–∞ –∫–∞–∑–Ω–∞ –æ–ø—É—Å—Ç–µ–ª–∞. –¢–æ—Ä–≥–æ–≤–ª—è –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∞—Å—å.';
                } else {
                    title = 'üèÅ –ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê!';
                    message = '–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 2020 –≥–æ–¥–∞. –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...';
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ—Ä–¥
                const highScore = localStorage.getItem('highScore') || 0;
                if (finalScore > highScore) {
                    localStorage.setItem('highScore', finalScore);
                    message += '\nüèÜ –£–°–¢–ê–ù–û–í–õ–ï–ù –ù–û–í–´–ô –†–ï–ö–û–†–î!';
                }
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('finalGold').textContent = this.gold;
                document.getElementById('finalRoutes').textContent = this.routes.length;
                document.getElementById('finalTraders').textContent = this.totalTraders;
                document.getElementById('finalScore').textContent = finalScore;
                document.getElementById('resultsTitle').textContent = title;
                document.getElementById('resultsMessage').innerHTML = message.replace('\n', '<br>');
                
                // –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                document.getElementById('strategyAnalysis').innerHTML = this.generateStrategyAnalysis();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                setTimeout(() => {
                    document.getElementById('resultsModal').classList.add('active');
                }, 1000);
            }

            generateStrategyAnalysis() {
                const totalDistance = this.routes.reduce((sum, route) => {
                    return sum + route.cities.reduce((dist, city, i, arr) => {
                        return i > 0 ? dist + this.calculateDistance(arr[i-1], city) : dist;
                    }, 0);
                }, 0);
                
                const avgRouteLength = this.routes.length > 0 ? 
                    this.routes.reduce((sum, route) => sum + route.cities.length, 0) / this.routes.length : 0;
                
                let analysis = `
                    <p>–í—ã —É–ø—Ä–∞–≤–ª—è–ª–∏ —Ç–æ—Ä–≥–æ–≤–ª–µ–π —á–µ—Ä–µ–∑ ${Math.min(this.currentEra + 1, this.eras.length)} –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —ç–ø–æ—Ö.</p>
                    <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞: <strong>${this.baseRouteLength} –≥–æ—Ä–æ–¥–æ–≤</strong></p>
                    <p>–û–±—â–∞—è –ø—Ä–æ–π–¥–µ–Ω–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è: <strong>${Math.round(totalDistance)} —à–∞–≥–æ–≤</strong></p>
                    <p>–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞: <strong>${avgRouteLength.toFixed(1)} –≥–æ—Ä–æ–¥–æ–≤</strong></p>
                `;
                
                // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                if (this.totalTraders < 5) {
                    analysis += '<div class="strategy-tip">';
                    analysis += '<h4><i class="fas fa-users"></i> –ù–£–ñ–ù–û –ë–û–õ–¨–®–ï –¢–û–†–ì–û–í–¶–ï–í</h4>';
                    analysis += '<p>–ü–æ—Å–µ—â–∞–π—Ç–µ –≥–æ—Ä–æ–¥–∞ –≤–ø–µ—Ä–≤—ã–µ - –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥ –¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤—Ü–∞!</p>';
                    analysis += '</div>';
                }
                
                if (this.baseRouteLength < 6) {
                    analysis += '<div class="strategy-tip">';
                    analysis += '<h4><i class="fas fa-road"></i> –ö–û–†–û–¢–ö–ò–ï –ú–ê–†–®–†–£–¢–´</h4>';
                    analysis += '<p>–î–ª–∏–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –¥–ª—è –≤—Å–µ—Ö –∏ –ø—Ä–∏–Ω–æ—Å—è—Ç –±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏.</p>';
                    analysis += '</div>';
                }
                
                const discoveredPercent = Math.round((this.discoveredCities.size / this.cities.length) * 100);
                analysis += `<p>–û—Ç–∫—Ä—ã—Ç–æ –≥–æ—Ä–æ–¥–æ–≤: <strong>${discoveredPercent}%</strong> (${this.discoveredCities.size} –∏–∑ ${this.cities.length})</p>`;
                
                return analysis;
            }

            getYearText() {
                return this.year < 0 ? `${Math.abs(this.year)} –≥. –¥–æ –Ω.—ç.` : `${this.year} –≥.`;
            }

            logEvent(text) {
                const eventLog = document.getElementById('eventLog');
                const eventDiv = document.createElement('div');
                eventDiv.style.cssText = `
                    padding: 8px;
                    margin-bottom: 5px;
                    background: rgba(58, 44, 0, 0.4);
                    border-radius: 4px;
                    border-left: 3px solid var(--color-primary);
                    font-size: 12px;
                    color: var(--color-text);
                `;
                eventDiv.textContent = text;
                
                eventLog.insertBefore(eventDiv, eventLog.firstChild);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
                if (eventLog.children.length > 20) {
                    eventLog.removeChild(eventLog.lastChild);
                }
            }

            showNotification(title, message) {
                const notification = document.getElementById('notification');
                document.getElementById('notificationTitle').textContent = title;
                document.getElementById('notificationMessage').textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }

            setupEventListeners() {
                document.getElementById('playPauseBtn').addEventListener('click', () => this.playPause());
                document.getElementById('autoRouteBtn').addEventListener('click', () => this.autoRoute());
                document.getElementById('confirmRouteBtn').addEventListener('click', () => this.confirmRoute());
                document.querySelector('.notification-close').addEventListener('click', () => {
                    document.getElementById('notification').classList.remove('show');
                });
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
                document.getElementById('notification').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('notification')) {
                        document.getElementById('notification').classList.remove('show');
                    }
                });
            }

            updateUI() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–æ–¥
                document.getElementById('yearNumber').textContent = Math.abs(this.year);
                document.getElementById('yearNumber').nextElementSibling.textContent = 
                    this.year < 0 ? '–î–û –ù–ê–®–ï–ô –≠–†–´' : '';
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                document.getElementById('statGold').textContent = this.gold;
                document.getElementById('statTraders').textContent = `${this.availableTraders}/${this.totalTraders}`;
                document.getElementById('statRoutes').textContent = this.activeRoutes;
                document.getElementById('statCities').textContent = `${this.discoveredCities.size}/${this.cities.length}`;
                
                // –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å
                document.getElementById('goldValue').textContent = this.gold;
                document.getElementById('tradersValue').textContent = this.availableTraders;
                document.getElementById('routeLength').textContent = this.baseRouteLength;
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ
                if (this.gold < 300) {
                    document.getElementById('goldValue').style.color = '#8b0000';
                    document.getElementById('statGold').style.color = '#8b0000';
                } else {
                    document.getElementById('goldValue').style.color = 'var(--color-primary)';
                    document.getElementById('statGold').style.color = 'var(--color-primary)';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
                document.getElementById('autoRouteBtn').disabled = this.gold < 50 || this.availableTraders === 0;
                document.getElementById('playPauseBtn').disabled = this.activeRoutes === 0;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        let game;
        window.addEventListener('load', () => {
            game = new HistoricalTradingGame();
        });
    </script>
</body>
</html>